# ğŸ—ï¸ EventMax System Architecture Design Document

## Enterprise-Grade High-Performance Event Booking Platform

**Version:** 2.0  
**Date:** December 2025  
**Author:** EventMax Engineering Team  
**Classification:** Technical Architecture Document

---

## ğŸ“‹ Table of Contents

### Part 1: High-Level System Design
1. [Executive Summary](#1-executive-summary)
2. [System Overview & Goals](#2-system-overview--goals)
3. [Architecture Patterns & Principles](#3-architecture-patterns--principles)
4. [Scalability & Load Balancing](#4-scalability--load-balancing)
5. [Caching Architecture](#5-caching-architecture)
6. [Database Architecture](#6-database-architecture)
7. [High Availability & Fault Tolerance](#7-high-availability--fault-tolerance)

### Part 2: Low-Level System Design (Continue for Part 2)
8. API Design & Rate Limiting
9. Microservices Architecture
10. Message Queue & Event-Driven Architecture
11. Security Architecture
12. Monitoring & Observability
13. Disaster Recovery & Backup
14. Performance Optimization
15. Deployment Strategy

---

# PART 1: HIGH-LEVEL SYSTEM DESIGN

---

## 1. Executive Summary

EventMax is designed as an **enterprise-grade, highly scalable event booking platform** capable of handling:

| Metric | Target Capacity |
|--------|-----------------|
| **Concurrent Users** | 100,000+ |
| **Requests/Second** | 50,000 RPS |
| **Database Transactions** | 10,000 TPS |
| **Uptime SLA** | 99.99% |
| **Response Time (P99)** | < 200ms |
| **Booking Latency** | < 500ms |

### Key Design Principles
- **Horizontal Scalability** - Scale out, not up
- **Fault Tolerance** - No single point of failure
- **Eventually Consistent** - For non-critical paths
- **ACID Compliance** - For financial transactions
- **Defense in Depth** - Multi-layer security

---

## 2. System Overview & Goals

### 2.1 Business Requirements

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EventMax Business Goals                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ« Real-time seat booking with < 500ms latency                             â”‚
â”‚  ğŸ’° Secure payment processing (PCI-DSS compliant)                           â”‚
â”‚  ğŸ“Š Handle flash sales with 10x normal traffic spikes                       â”‚
â”‚  ğŸŒ Multi-region deployment for low latency globally                        â”‚
â”‚  ğŸ“± Support web, mobile, and API clients                                    â”‚
â”‚  ğŸ”’ Zero data breaches, enterprise security                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Technical Requirements

| Category | Requirement | Implementation |
|----------|-------------|----------------|
| **Availability** | 99.99% uptime | Multi-AZ, Auto-failover |
| **Latency** | P99 < 200ms | CDN, Edge caching, Redis |
| **Throughput** | 50K RPS | Horizontal scaling, Load balancing |
| **Data Durability** | 99.999999999% | Multi-region replication |
| **Recovery** | RPO < 1min, RTO < 5min | Hot standby, Point-in-time recovery |

### 2.3 Capacity Planning

```
Peak Load Calculation:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Expected Users:           1,000,000 registered users
Daily Active Users:       100,000 (10%)
Peak Concurrent:          10,000 users
Flash Sale Spike:         100,000 concurrent (10x normal)

Requests per user:        10 requests/minute average
Normal RPS:               (10,000 Ã— 10) / 60 = ~1,667 RPS
Peak RPS:                 (100,000 Ã— 20) / 60 = ~33,333 RPS
Design Target:            50,000 RPS (1.5x headroom)

Database Writes:          500 bookings/second peak
Redis Operations:         100,000 ops/second
WebSocket Connections:    50,000 concurrent
```

---

## 3. Architecture Patterns & Principles

### 3.1 High-Level Architecture Diagram

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚           GLOBAL CDN (CloudFlare)       â”‚
                                    â”‚    - Static Assets                      â”‚
                                    â”‚    - DDoS Protection                    â”‚
                                    â”‚    - Edge Caching                       â”‚
                                    â”‚    - WAF (Web Application Firewall)     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                 â”‚                                 â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   Mumbai DC     â”‚               â”‚  Bangalore DC â”‚               â”‚   Chennai DC      â”‚
           â”‚   (Primary)     â”‚               â”‚  (Secondary)  â”‚               â”‚   (DR Site)       â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                â”‚                                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚         LOAD BALANCER CLUSTER               â”‚
                              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                              â”‚   â”‚  HAProxy / AWS ALB / NGINX Plus     â”‚   â”‚
                              â”‚   â”‚  - Layer 7 Load Balancing           â”‚   â”‚
                              â”‚   â”‚  - SSL Termination                  â”‚   â”‚
                              â”‚   â”‚  - Health Checks                    â”‚   â”‚
                              â”‚   â”‚  - Rate Limiting                    â”‚   â”‚
                              â”‚   â”‚  - Session Affinity                 â”‚   â”‚
                              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                            â”‚                                            â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚    â”‚                    API GATEWAY LAYER                                          â”‚    â”‚
        â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
        â”‚    â”‚  â”‚   Kong /    â”‚  â”‚   Rate      â”‚  â”‚   Auth      â”‚  â”‚   Request   â”‚          â”‚    â”‚
        â”‚    â”‚  â”‚   Traefik   â”‚  â”‚   Limiter   â”‚  â”‚   Validator â”‚  â”‚   Router    â”‚          â”‚    â”‚
        â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                            â”‚                                            â”‚
        â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
        â”‚    â”‚                 APPLICATION SERVICES LAYER                                    â”‚    â”‚
        â”‚    â”‚                                                                               â”‚    â”‚
        â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
        â”‚    â”‚  â”‚   Auth       â”‚  â”‚   Event      â”‚  â”‚   Booking    â”‚  â”‚   Payment    â”‚      â”‚    â”‚
        â”‚    â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚      â”‚    â”‚
        â”‚    â”‚  â”‚   (3 pods)   â”‚  â”‚   (5 pods)   â”‚  â”‚   (10 pods)  â”‚  â”‚   (5 pods)   â”‚      â”‚    â”‚
        â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
        â”‚    â”‚                                                                               â”‚    â”‚
        â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚    â”‚
        â”‚    â”‚  â”‚   User       â”‚  â”‚   Search     â”‚  â”‚   Notifica-  â”‚  â”‚   Analytics  â”‚      â”‚    â”‚
        â”‚    â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚   tion Svc   â”‚  â”‚   Service    â”‚      â”‚    â”‚
        â”‚    â”‚  â”‚   (3 pods)   â”‚  â”‚   (3 pods)   â”‚  â”‚   (3 pods)   â”‚  â”‚   (2 pods)   â”‚      â”‚    â”‚
        â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚    â”‚
        â”‚    â”‚                                                                               â”‚    â”‚
        â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
        â”‚                                            â”‚                                            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                              DATA LAYER                                                 â”‚
        â”‚                                                                                         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚  â”‚   PostgreSQL        â”‚  â”‚   Redis Cluster     â”‚  â”‚   Elasticsearch     â”‚             â”‚
        â”‚  â”‚   Cluster           â”‚  â”‚                     â”‚  â”‚   Cluster           â”‚             â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
        â”‚  â”‚  â”‚   Primary     â”‚  â”‚  â”‚  â”‚   Master-1    â”‚  â”‚  â”‚  â”‚   Node-1      â”‚  â”‚             â”‚
        â”‚  â”‚  â”‚   (Write)     â”‚  â”‚  â”‚  â”‚   (Shard 1)   â”‚  â”‚  â”‚  â”‚   (Data)      â”‚  â”‚             â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
        â”‚  â”‚  â”‚   Replica-1   â”‚  â”‚  â”‚  â”‚   Master-2    â”‚  â”‚  â”‚  â”‚   Node-2      â”‚  â”‚             â”‚
        â”‚  â”‚  â”‚   (Read)      â”‚  â”‚  â”‚  â”‚   (Shard 2)   â”‚  â”‚  â”‚  â”‚   (Data)      â”‚  â”‚             â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
        â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚             â”‚
        â”‚  â”‚  â”‚   Replica-2   â”‚  â”‚  â”‚  â”‚   Master-3    â”‚  â”‚  â”‚  â”‚   Node-3      â”‚  â”‚             â”‚
        â”‚  â”‚  â”‚   (Read)      â”‚  â”‚  â”‚  â”‚   (Shard 3)   â”‚  â”‚  â”‚  â”‚   (Ingest)    â”‚  â”‚             â”‚
        â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚             â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                                                                                         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚  â”‚   RabbitMQ /        â”‚  â”‚   S3 / MinIO        â”‚  â”‚   ClickHouse        â”‚             â”‚
        â”‚  â”‚   Apache Kafka      â”‚  â”‚   Object Storage    â”‚  â”‚   (Analytics)       â”‚             â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                                                                                         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Core Architecture Patterns

#### Pattern 1: CQRS (Command Query Responsibility Segregation)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CQRS PATTERN                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   WRITE PATH (Commands)              READ PATH (Queries)                    â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”              â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                    â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”‚   Client    â”‚                    â”‚   Client    â”‚                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚          â”‚                                  â”‚                               â”‚
â”‚          â–¼                                  â–¼                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”‚  Command    â”‚                    â”‚   Query     â”‚                       â”‚
â”‚   â”‚  Handler    â”‚                    â”‚   Handler   â”‚                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚          â”‚                                  â”‚                               â”‚
â”‚          â–¼                                  â–¼                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚   â”‚  PostgreSQL â”‚â”€â”€â”€â”€â”€ Async â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Redis     â”‚                       â”‚
â”‚   â”‚  (Primary)  â”‚     Sync           â”‚   Cache     â”‚                       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                             â”‚                               â”‚
â”‚                                             â–¼                               â”‚
â”‚                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                                      â”‚   Read      â”‚                       â”‚
â”‚                                      â”‚   Replicas  â”‚                       â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                             â”‚
â”‚   Benefits:                                                                 â”‚
â”‚   â€¢ Optimized read/write paths separately                                  â”‚
â”‚   â€¢ Better scalability (scale reads independently)                         â”‚
â”‚   â€¢ Reduced contention on database                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Pattern 2: Event Sourcing for Booking System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EVENT SOURCING PATTERN                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Instead of storing current state, store all events that led to it:       â”‚
â”‚                                                                             â”‚
â”‚   Event Stream for Booking #BK123456:                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  1. SeatSelected      { seatId: "A1", eventId: "E001", time: T1 }   â”‚   â”‚
â”‚   â”‚  2. SeatSelected      { seatId: "A2", eventId: "E001", time: T2 }   â”‚   â”‚
â”‚   â”‚  3. BookingInitiated  { seats: ["A1","A2"], userId: "U1", time: T3 }â”‚   â”‚
â”‚   â”‚  4. PaymentReceived   { amount: 5000, txnId: "TXN1", time: T4 }     â”‚   â”‚
â”‚   â”‚  5. BookingConfirmed  { bookingId: "BK123456", time: T5 }           â”‚   â”‚
â”‚   â”‚  6. TicketGenerated   { ticketUrl: "...", time: T6 }                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   Benefits:                                                                 â”‚
â”‚   â€¢ Complete audit trail                                                    â”‚
â”‚   â€¢ Time-travel debugging                                                   â”‚
â”‚   â€¢ Replay events for analytics                                            â”‚
â”‚   â€¢ Easy undo/redo operations                                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Pattern 3: Circuit Breaker Pattern

```javascript
// Circuit Breaker Implementation
class CircuitBreaker {
  constructor(options = {}) {
    this.failureThreshold = options.failureThreshold || 5;
    this.successThreshold = options.successThreshold || 2;
    this.timeout = options.timeout || 30000; // 30 seconds
    
    this.state = 'CLOSED';  // CLOSED -> OPEN -> HALF_OPEN
    this.failureCount = 0;
    this.successCount = 0;
    this.lastFailureTime = null;
  }

  async execute(fn) {
    if (this.state === 'OPEN') {
      if (Date.now() - this.lastFailureTime >= this.timeout) {
        this.state = 'HALF_OPEN';
      } else {
        throw new Error('Circuit is OPEN - Service unavailable');
      }
    }

    try {
      const result = await fn();
      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }

  onSuccess() {
    this.failureCount = 0;
    if (this.state === 'HALF_OPEN') {
      this.successCount++;
      if (this.successCount >= this.successThreshold) {
        this.state = 'CLOSED';
        this.successCount = 0;
      }
    }
  }

  onFailure() {
    this.failureCount++;
    this.lastFailureTime = Date.now();
    if (this.failureCount >= this.failureThreshold) {
      this.state = 'OPEN';
    }
  }
}

// Usage
const paymentCircuitBreaker = new CircuitBreaker({
  failureThreshold: 3,
  timeout: 60000
});

await paymentCircuitBreaker.execute(() => paymentService.processPayment(data));
```

---

## 4. Scalability & Load Balancing

### 4.1 Horizontal Scaling Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     HORIZONTAL SCALING ARCHITECTURE                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   AUTO-SCALING RULES:                                                       â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  Service          â”‚ Min â”‚ Max â”‚ Scale Up Trigger   â”‚ Scale Down   â”‚    â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚   â”‚  API Gateway      â”‚  3  â”‚ 20  â”‚ CPU > 70%          â”‚ CPU < 30%    â”‚    â”‚
â”‚   â”‚  Auth Service     â”‚  3  â”‚ 10  â”‚ RPS > 1000/pod     â”‚ RPS < 200    â”‚    â”‚
â”‚   â”‚  Event Service    â”‚  5  â”‚ 30  â”‚ CPU > 60%          â”‚ CPU < 25%    â”‚    â”‚
â”‚   â”‚  Booking Service  â”‚ 10  â”‚ 50  â”‚ Queue depth > 100  â”‚ Queue < 10   â”‚    â”‚
â”‚   â”‚  Payment Service  â”‚  5  â”‚ 20  â”‚ Latency P99 > 1s   â”‚ P99 < 200ms  â”‚    â”‚
â”‚   â”‚  Search Service   â”‚  3  â”‚ 15  â”‚ CPU > 70%          â”‚ CPU < 30%    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚   SCALING TIMELINE (Flash Sale Scenario):                                   â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                   â”‚
â”‚                                                                             â”‚
â”‚   T-30min: Pre-warm 50 booking pods (scheduled scaling)                    â”‚
â”‚   T-0:     Flash sale starts, traffic spike detected                       â”‚
â”‚   T+30sec: HPA triggers, scales to 100 pods                                â”‚
â”‚   T+2min:  Peak load, 150 pods active                                      â”‚
â”‚   T+30min: Traffic normalizes, gradual scale-down                          â”‚
â”‚   T+60min: Back to minimum pod count                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Load Balancing Algorithms

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LOAD BALANCING STRATEGIES                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. WEIGHTED ROUND ROBIN (Default)                                         â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Weight: 3     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚   Client    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Pod A     â”‚  (High capacity)       â”‚
â”‚   â”‚             â”‚                    â”‚   16GB RAM  â”‚                        â”‚
â”‚   â”‚             â”‚     Weight: 2     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚             â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Pod B     â”‚  (Medium capacity)     â”‚
â”‚   â”‚             â”‚                    â”‚   8GB RAM   â”‚                        â”‚
â”‚   â”‚             â”‚     Weight: 1     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   â”‚             â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Pod C     â”‚  (Standard)            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   4GB RAM   â”‚                        â”‚
â”‚                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                             â”‚
â”‚   2. LEAST CONNECTIONS (For long-running requests)                         â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                         â”‚
â”‚                                                                             â”‚
â”‚   Route to pod with fewest active connections                              â”‚
â”‚   Best for: WebSocket connections, file uploads                            â”‚
â”‚                                                                             â”‚
â”‚   3. IP HASH (Session Affinity)                                            â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                            â”‚
â”‚                                                                             â”‚
â”‚   hash(client_ip) % num_pods = target_pod                                  â”‚
â”‚   Best for: Stateful sessions, cart management                             â”‚
â”‚                                                                             â”‚
â”‚   4. ADAPTIVE / LATENCY-BASED                                              â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                           â”‚
â”‚                                                                             â”‚
â”‚   Route to pod with lowest response time                                   â”‚
â”‚   Continuously monitors P99 latency per pod                                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 Kubernetes HPA Configuration

```yaml
# kubernetes/booking-service-hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: booking-service-hpa
  namespace: eventmax
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: booking-service
  
  minReplicas: 10
  maxReplicas: 100
  
  metrics:
    # CPU-based scaling
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 60
    
    # Memory-based scaling
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 70
    
    # Custom metric: Requests per second
    - type: Pods
      pods:
        metric:
          name: http_requests_per_second
        target:
          type: AverageValue
          averageValue: "1000"
    
    # Custom metric: Queue depth
    - type: External
      external:
        metric:
          name: rabbitmq_queue_messages
          selector:
            matchLabels:
              queue: booking-queue
        target:
          type: AverageValue
          averageValue: "50"
  
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 30
      policies:
        - type: Percent
          value: 100
          periodSeconds: 15
        - type: Pods
          value: 10
          periodSeconds: 15
      selectPolicy: Max
    
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
        - type: Percent
          value: 10
          periodSeconds: 60
```

---

## 5. Caching Architecture

### 5.1 Multi-Level Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       MULTI-LEVEL CACHE ARCHITECTURE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                            â”‚   Client    â”‚                                  â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                   â”‚                                         â”‚
â”‚   L1: BROWSER CACHE               â–¼                                         â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   TTL: 5 minutes      â”‚   Browser Cache     â”‚  Cache-Control headers       â”‚
â”‚   Hit Rate: 60%       â”‚   (Service Worker)  â”‚  Static assets, API cache    â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                  â”‚                                          â”‚
â”‚   L2: CDN EDGE CACHE             â–¼                                         â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   TTL: 1 hour         â”‚   CloudFlare Edge   â”‚  Event listings, images      â”‚
â”‚   Hit Rate: 80%       â”‚   (200+ PoPs)       â”‚  JS/CSS bundles              â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                  â”‚                                          â”‚
â”‚   L3: APPLICATION CACHE          â–¼                                         â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   TTL: 5-60 seconds   â”‚   Redis Cluster     â”‚  Session, seat availability  â”‚
â”‚   Hit Rate: 95%       â”‚   (In-memory)       â”‚  User data, event details    â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                  â”‚                                          â”‚
â”‚   L4: DATABASE CACHE             â–¼                                         â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚   TTL: N/A            â”‚   PostgreSQL        â”‚  Query plan cache            â”‚
â”‚   Hit Rate: 90%       â”‚   (Buffer Pool)     â”‚  Materialized views          â”‚
â”‚                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                             â”‚
â”‚   CACHE INVALIDATION STRATEGY:                                             â”‚
â”‚   â€¢ Write-through for critical data (seat status)                          â”‚
â”‚   â€¢ TTL-based expiry for semi-static data (event details)                  â”‚
â”‚   â€¢ Pub/Sub invalidation for distributed cache                             â”‚
â”‚   â€¢ Version-based cache busting for static assets                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Redis Cluster Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         REDIS CLUSTER TOPOLOGY                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   6-Node Cluster (3 Masters + 3 Replicas)                                  â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚   â”‚   â”‚  Master 1   â”‚     â”‚  Master 2   â”‚     â”‚  Master 3   â”‚          â”‚   â”‚
â”‚   â”‚   â”‚  Slots:     â”‚     â”‚  Slots:     â”‚     â”‚  Slots:     â”‚          â”‚   â”‚
â”‚   â”‚   â”‚  0-5460     â”‚     â”‚  5461-10922 â”‚     â”‚  10923-16383â”‚          â”‚   â”‚
â”‚   â”‚   â”‚  (sessions) â”‚     â”‚  (events)   â”‚     â”‚  (seats)    â”‚          â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚   â”‚          â”‚                   â”‚                   â”‚                 â”‚   â”‚
â”‚   â”‚          â–¼                   â–¼                   â–¼                 â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚   â”‚   â”‚  Replica 1  â”‚     â”‚  Replica 2  â”‚     â”‚  Replica 3  â”‚          â”‚   â”‚
â”‚   â”‚   â”‚  (Standby)  â”‚     â”‚  (Standby)  â”‚     â”‚  (Standby)  â”‚          â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   DATA PARTITIONING:                                                        â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                       â”‚
â”‚                                                                             â”‚
â”‚   Prefix      â”‚ Data Type           â”‚ TTL      â”‚ Shard                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚   sess:       â”‚ User sessions       â”‚ 24h      â”‚ Master 1                  â”‚
â”‚   user:       â”‚ User profiles       â”‚ 1h       â”‚ Master 1                  â”‚
â”‚   event:      â”‚ Event details       â”‚ 5min     â”‚ Master 2                  â”‚
â”‚   search:     â”‚ Search results      â”‚ 1min     â”‚ Master 2                  â”‚
â”‚   seat:       â”‚ Seat availability   â”‚ 10sec    â”‚ Master 3                  â”‚
â”‚   lock:       â”‚ Distributed locks   â”‚ 30sec    â”‚ Master 3                  â”‚
â”‚   rate:       â”‚ Rate limit counters â”‚ 1min     â”‚ Master 1                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 Cache Implementation Code

```javascript
// services/cacheService.js
const Redis = require('ioredis');

class CacheService {
  constructor() {
    this.cluster = new Redis.Cluster([
      { host: 'redis-1', port: 6379 },
      { host: 'redis-2', port: 6379 },
      { host: 'redis-3', port: 6379 },
    ], {
      redisOptions: {
        password: process.env.REDIS_PASSWORD,
        enableReadyCheck: true,
        maxRetriesPerRequest: 3,
      },
      scaleReads: 'slave', // Read from replicas
      enableOfflineQueue: false,
    });
  }

  // Cache-aside pattern with stale-while-revalidate
  async getOrSet(key, fetchFn, options = {}) {
    const { ttl = 300, staleTime = 60 } = options;
    
    const cached = await this.cluster.get(key);
    
    if (cached) {
      const data = JSON.parse(cached);
      const age = Date.now() - data.cachedAt;
      
      // Return cached data, refresh in background if stale
      if (age > (ttl - staleTime) * 1000) {
        this.refreshInBackground(key, fetchFn, ttl);
      }
      return data.value;
    }
    
    // Cache miss - fetch and store
    const value = await fetchFn();
    await this.set(key, value, ttl);
    return value;
  }

  async set(key, value, ttl = 300) {
    const data = {
      value,
      cachedAt: Date.now(),
    };
    await this.cluster.setex(key, ttl, JSON.stringify(data));
  }

  async refreshInBackground(key, fetchFn, ttl) {
    setImmediate(async () => {
      try {
        const value = await fetchFn();
        await this.set(key, value, ttl);
      } catch (error) {
        console.error(`Background refresh failed for ${key}:`, error);
      }
    });
  }

  // Distributed lock for seat reservation
  async acquireLock(resource, ttl = 30000) {
    const lockKey = `lock:${resource}`;
    const lockValue = `${process.pid}-${Date.now()}`;
    
    const acquired = await this.cluster.set(
      lockKey, 
      lockValue, 
      'PX', ttl, 
      'NX'
    );
    
    return acquired ? lockValue : null;
  }

  async releaseLock(resource, lockValue) {
    const lockKey = `lock:${resource}`;
    const script = `
      if redis.call("get", KEYS[1]) == ARGV[1] then
        return redis.call("del", KEYS[1])
      else
        return 0
      end
    `;
    return this.cluster.eval(script, 1, lockKey, lockValue);
  }
}

module.exports = new CacheService();
```

---

## 6. Database Architecture

### 6.1 PostgreSQL Cluster Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    POSTGRESQL HIGH AVAILABILITY SETUP                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   PATRONI-MANAGED CLUSTER                                                  â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                   â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         ETCD CLUSTER                                â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   â”‚
â”‚   â”‚   â”‚  etcd-1  â”‚    â”‚  etcd-2  â”‚    â”‚  etcd-3  â”‚                     â”‚   â”‚
â”‚   â”‚   â”‚  (leader)â”‚    â”‚          â”‚    â”‚          â”‚                     â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚                                           â”‚
â”‚                                 â–¼                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      PATRONI CLUSTER                                â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚   â”‚   â”‚   PostgreSQL  â”‚  â”‚   PostgreSQL  â”‚  â”‚   PostgreSQL  â”‚          â”‚   â”‚
â”‚   â”‚   â”‚   Primary     â”‚  â”‚   Sync Rep    â”‚  â”‚   Async Rep   â”‚          â”‚   â”‚
â”‚   â”‚   â”‚   (Mumbai)    â”‚  â”‚   (Bangalore) â”‚  â”‚   (Chennai)   â”‚          â”‚   â”‚
â”‚   â”‚   â”‚               â”‚  â”‚               â”‚  â”‚               â”‚          â”‚   â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚   â”‚
â”‚   â”‚   â”‚  â”‚ Patroni â”‚  â”‚  â”‚  â”‚ Patroni â”‚  â”‚  â”‚  â”‚ Patroni â”‚  â”‚          â”‚   â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Replication: Primary â”€â”€â”€ sync â”€â”€â”€â–¶ Sync Rep                      â”‚   â”‚
â”‚   â”‚                       â””â”€â”€â”€ async â”€â”€â–¶ Async Rep                     â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                       PGBOUNCER POOL                                â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚   â”‚  Connection Pooling Configuration                            â”‚  â”‚   â”‚
â”‚   â”‚   â”‚                                                              â”‚  â”‚   â”‚
â”‚   â”‚   â”‚  pool_mode = transaction                                     â”‚  â”‚   â”‚
â”‚   â”‚   â”‚  max_client_conn = 10000                                     â”‚  â”‚   â”‚
â”‚   â”‚   â”‚  default_pool_size = 100                                     â”‚  â”‚   â”‚
â”‚   â”‚   â”‚  reserve_pool_size = 25                                      â”‚  â”‚   â”‚
â”‚   â”‚   â”‚  server_idle_timeout = 60                                    â”‚  â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   FAILOVER SCENARIOS:                                                       â”‚
â”‚   â€¢ Primary failure â†’ Sync replica promoted (< 10 sec)                     â”‚
â”‚   â€¢ Sync replica failure â†’ Async promoted to sync                          â”‚
â”‚   â€¢ Automatic DNS update via Consul                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Database Sharding Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATABASE SHARDING DESIGN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   SHARDING KEY: event_id (for bookings, seats)                             â”‚
â”‚   SHARDING METHOD: Range-based with consistent hashing                     â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      SHARD DISTRIBUTION                             â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Application Layer                                                 â”‚   â”‚
â”‚   â”‚         â”‚                                                           â”‚   â”‚
â”‚   â”‚         â–¼                                                           â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚   â”‚              SHARD ROUTER (Vitess / Citus)                  â”‚   â”‚   â”‚
â”‚   â”‚   â”‚                                                             â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   hash(event_id) % 4 = shard_number                         â”‚   â”‚   â”‚
â”‚   â”‚   â”‚                                                             â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚              â”‚          â”‚          â”‚          â”‚                    â”‚   â”‚
â”‚   â”‚              â–¼          â–¼          â–¼          â–¼                    â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚   â”‚
â”‚   â”‚   â”‚   Shard 0    â”‚ â”‚   Shard 1    â”‚ â”‚   Shard 2    â”‚ â”‚   Shard 3    â”‚â”‚   â”‚
â”‚   â”‚   â”‚              â”‚ â”‚              â”‚ â”‚              â”‚ â”‚              â”‚â”‚   â”‚
â”‚   â”‚   â”‚ Events:      â”‚ â”‚ Events:      â”‚ â”‚ Events:      â”‚ â”‚ Events:      â”‚â”‚   â”‚
â”‚   â”‚   â”‚ 0,4,8,12...  â”‚ â”‚ 1,5,9,13...  â”‚ â”‚ 2,6,10,14... â”‚ â”‚ 3,7,11,15... â”‚â”‚   â”‚
â”‚   â”‚   â”‚              â”‚ â”‚              â”‚ â”‚              â”‚ â”‚              â”‚â”‚   â”‚
â”‚   â”‚   â”‚ Seats for    â”‚ â”‚ Seats for    â”‚ â”‚ Seats for    â”‚ â”‚ Seats for    â”‚â”‚   â”‚
â”‚   â”‚   â”‚ these events â”‚ â”‚ these events â”‚ â”‚ these events â”‚ â”‚ these events â”‚â”‚   â”‚
â”‚   â”‚   â”‚              â”‚ â”‚              â”‚ â”‚              â”‚ â”‚              â”‚â”‚   â”‚
â”‚   â”‚   â”‚ Bookings for â”‚ â”‚ Bookings for â”‚ â”‚ Bookings for â”‚ â”‚ Bookings for â”‚â”‚   â”‚
â”‚   â”‚   â”‚ these events â”‚ â”‚ these events â”‚ â”‚ these events â”‚ â”‚ these events â”‚â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   GLOBAL TABLES (Replicated across all shards):                            â”‚
â”‚   â€¢ users (reference data)                                                 â”‚
â”‚   â€¢ event_categories (reference data)                                      â”‚
â”‚   â€¢ payment_methods (per-user, not event-specific)                         â”‚
â”‚                                                                             â”‚
â”‚   CROSS-SHARD QUERIES:                                                     â”‚
â”‚   â€¢ User bookings across events â†’ Scatter-gather pattern                   â”‚
â”‚   â€¢ Analytics queries â†’ ClickHouse (separate OLAP database)                â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 Optimized Indexes

```sql
-- High-performance indexes for EventMax

-- Composite index for seat availability queries (most critical)
CREATE INDEX CONCURRENTLY idx_seats_event_availability 
ON seats (event_id, status, section, current_price)
WHERE status = 'available';

-- Covering index for booking queries (includes all needed columns)
CREATE INDEX CONCURRENTLY idx_bookings_user_covering
ON bookings (user_id, created_at DESC)
INCLUDE (id, booking_reference, event_id, total_amount, status)
WHERE deleted_at IS NULL;

-- Partial index for active events only
CREATE INDEX CONCURRENTLY idx_events_active_featured
ON events (event_date, is_featured)
WHERE status = 'published' AND deleted_at IS NULL;

-- BRIN index for time-series data (audit logs)
CREATE INDEX idx_audit_logs_time_brin
ON audit_logs USING BRIN (performed_at)
WITH (pages_per_range = 32);

-- GIN index for full-text search on events
CREATE INDEX idx_events_search_gin
ON events USING GIN (
  to_tsvector('english', 
    coalesce(title, '') || ' ' || 
    coalesce(description, '') || ' ' ||
    coalesce(venue_name, '')
  )
);

-- Expression index for case-insensitive email lookup
CREATE UNIQUE INDEX idx_users_email_lower
ON users (LOWER(email))
WHERE deleted_at IS NULL;
```

---

## 7. High Availability & Fault Tolerance

### 7.1 Multi-Region Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MULTI-REGION DEPLOYMENT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                           GLOBAL TRAFFIC MANAGER                            â”‚
â”‚                           (AWS Route 53 / Azure Traffic Manager)            â”‚
â”‚                                      â”‚                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                    â”‚                 â”‚                 â”‚                    â”‚
â”‚                    â–¼                 â–¼                 â–¼                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   MUMBAI REGION    â”‚ â”‚  BANGALORE REGION  â”‚ â”‚   CHENNAI REGION   â”‚     â”‚
â”‚   â”‚   (Primary)        â”‚ â”‚  (Active)          â”‚ â”‚   (DR - Standby)   â”‚     â”‚
â”‚   â”‚                    â”‚ â”‚                    â”‚ â”‚                    â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚ K8s Cluster  â”‚  â”‚ â”‚  â”‚ K8s Cluster  â”‚  â”‚ â”‚  â”‚ K8s Cluster  â”‚  â”‚     â”‚
â”‚   â”‚  â”‚ 50 nodes     â”‚  â”‚ â”‚  â”‚ 30 nodes     â”‚  â”‚ â”‚  â”‚ 10 nodes     â”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚                    â”‚ â”‚                    â”‚ â”‚                    â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚ PostgreSQL   â”‚  â”‚ â”‚  â”‚ PostgreSQL   â”‚  â”‚ â”‚  â”‚ PostgreSQL   â”‚  â”‚     â”‚
â”‚   â”‚  â”‚ Primary      â”‚â—€â”€â”¼â”€â”¼â”€â”€â”‚ Sync Replica â”‚â—€â”€â”¼â”€â”¼â”€â”€â”‚ Async Replicaâ”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚                    â”‚ â”‚                    â”‚ â”‚                    â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚ Redis Master â”‚â—€â”€â”¼â”€â”¼â”€â”€â”‚ Redis Replicaâ”‚  â”‚ â”‚  â”‚ Redis Replicaâ”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚                    â”‚ â”‚                    â”‚ â”‚                    â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚   TRAFFIC DISTRIBUTION:                                                     â”‚
â”‚   â€¢ Mumbai: 60% (Primary, handles writes)                                  â”‚
â”‚   â€¢ Bangalore: 35% (Active, read replicas)                                 â”‚
â”‚   â€¢ Chennai: 5% (DR site, minimal traffic for testing)                     â”‚
â”‚                                                                             â”‚
â”‚   FAILOVER STRATEGY:                                                        â”‚
â”‚   1. Mumbai failure â†’ Traffic shifted to Bangalore (< 30 sec)              â”‚
â”‚   2. Bangalore DB promoted to Primary                                      â”‚
â”‚   3. Chennai activated as new secondary                                    â”‚
â”‚   4. RTO: < 5 minutes, RPO: < 1 minute                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 Chaos Engineering & Resilience Testing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CHAOS ENGINEERING PRACTICE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   REGULAR CHAOS EXPERIMENTS:                                               â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Experiment          â”‚ Frequency  â”‚ Blast Radius â”‚ Expected Result  â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Kill random pod     â”‚ Hourly     â”‚ Single pod   â”‚ Auto-restart     â”‚   â”‚
â”‚   â”‚  Network partition   â”‚ Daily      â”‚ AZ-level     â”‚ Failover < 30s   â”‚   â”‚
â”‚   â”‚  DB failover         â”‚ Weekly     â”‚ Region       â”‚ Promote replica  â”‚   â”‚
â”‚   â”‚  Redis cluster fail  â”‚ Weekly     â”‚ Shard        â”‚ Redirect traffic â”‚   â”‚
â”‚   â”‚  Full region outage  â”‚ Monthly    â”‚ Region       â”‚ DR activation    â”‚   â”‚
â”‚   â”‚  Latency injection   â”‚ Daily      â”‚ Service      â”‚ Circuit breaker  â”‚   â”‚
â”‚   â”‚  CPU stress test     â”‚ Weekly     â”‚ Node         â”‚ Auto-scale       â”‚   â”‚
â”‚   â”‚  Disk fill           â”‚ Monthly    â”‚ Volume       â”‚ Alert + cleanup  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   TOOLS:                                                                    â”‚
â”‚   â€¢ Chaos Monkey (Netflix) - Random instance termination                   â”‚
â”‚   â€¢ Gremlin - Enterprise chaos platform                                    â”‚
â”‚   â€¢ LitmusChaos - Kubernetes-native chaos                                  â”‚
â”‚   â€¢ Toxiproxy - Network failure simulation                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 Health Check & Self-Healing

```javascript
// Health check endpoint with deep checks
// GET /api/health

const healthCheck = async (req, res) => {
  const checks = {
    status: 'healthy',
    timestamp: new Date().toISOString(),
    version: process.env.APP_VERSION,
    uptime: process.uptime(),
    checks: {}
  };

  // Database check
  try {
    const start = Date.now();
    await pool.query('SELECT 1');
    checks.checks.database = {
      status: 'healthy',
      latency: Date.now() - start
    };
  } catch (error) {
    checks.status = 'unhealthy';
    checks.checks.database = {
      status: 'unhealthy',
      error: error.message
    };
  }

  // Redis check
  try {
    const start = Date.now();
    await redis.ping();
    checks.checks.redis = {
      status: 'healthy',
      latency: Date.now() - start
    };
  } catch (error) {
    checks.status = 'degraded';
    checks.checks.redis = {
      status: 'unhealthy',
      error: error.message
    };
  }

  // Memory check
  const memUsage = process.memoryUsage();
  const memPercentage = (memUsage.heapUsed / memUsage.heapTotal) * 100;
  checks.checks.memory = {
    status: memPercentage < 90 ? 'healthy' : 'warning',
    heapUsed: `${Math.round(memUsage.heapUsed / 1024 / 1024)}MB`,
    heapTotal: `${Math.round(memUsage.heapTotal / 1024 / 1024)}MB`,
    percentage: `${memPercentage.toFixed(1)}%`
  };

  // Response
  const httpStatus = checks.status === 'healthy' ? 200 : 
                     checks.status === 'degraded' ? 200 : 503;
  
  res.status(httpStatus).json(checks);
};
```

---

## ğŸ“Š Summary - Part 1 Complete

This completes **Part 1: High-Level System Design** covering:

âœ… System capacity planning for 100K+ concurrent users  
âœ… Multi-tier architecture with CDN, Load Balancer, API Gateway  
âœ… CQRS, Event Sourcing, and Circuit Breaker patterns  
âœ… Horizontal auto-scaling with Kubernetes HPA  
âœ… Multi-level caching (Browser â†’ CDN â†’ Redis â†’ PostgreSQL)  
âœ… Database HA with Patroni + PgBouncer  
âœ… Database sharding strategy  
âœ… Multi-region deployment across India  
âœ… Chaos engineering practices  

---

## â­ï¸ CONTINUE FOR PART 2

**Part 2A will cover:**
- API Design & Rate Limiting
- Microservices Architecture
- Message Queues (Kafka/RabbitMQ)
- Security Architecture

**Part 2B will cover:**
- Monitoring & Observability
- Disaster Recovery & Backup
- CI/CD Pipeline & Deployment
- Cost Optimization

---

# PART 2A: LOW-LEVEL SYSTEM DESIGN (API, Microservices, Security)

---

## 8. API Design & Rate Limiting

### 8.1 RESTful API Design Standards

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API DESIGN PRINCIPLES                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   RESOURCE NAMING CONVENTIONS:                                              â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                              â”‚
â”‚                                                                             â”‚
â”‚   âœ… CORRECT                          âŒ INCORRECT                          â”‚
â”‚   GET  /api/v1/events                 GET  /api/v1/getEvents               â”‚
â”‚   GET  /api/v1/events/{id}            GET  /api/v1/event/{id}              â”‚
â”‚   GET  /api/v1/events/{id}/seats      GET  /api/v1/eventSeats/{id}         â”‚
â”‚   POST /api/v1/bookings               POST /api/v1/createBooking           â”‚
â”‚   PUT  /api/v1/users/{id}             POST /api/v1/updateUser              â”‚
â”‚                                                                             â”‚
â”‚   HTTP STATUS CODES:                                                        â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                       â”‚
â”‚                                                                             â”‚
â”‚   200 OK           - Successful GET/PUT                                    â”‚
â”‚   201 Created      - Successful POST (resource created)                    â”‚
â”‚   204 No Content   - Successful DELETE                                     â”‚
â”‚   400 Bad Request  - Validation error                                      â”‚
â”‚   401 Unauthorized - Missing/invalid token                                 â”‚
â”‚   403 Forbidden    - Valid token, insufficient permissions                 â”‚
â”‚   404 Not Found    - Resource doesn't exist                                â”‚
â”‚   409 Conflict     - Seat already booked (race condition)                  â”‚
â”‚   422 Unprocessable- Business logic error                                  â”‚
â”‚   429 Too Many     - Rate limit exceeded                                   â”‚
â”‚   500 Server Error - Unexpected error                                      â”‚
â”‚   503 Unavailable  - Service down for maintenance                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 API Versioning Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          API VERSIONING                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   VERSIONING METHOD: URL Path Versioning                                   â”‚
â”‚                                                                             â”‚
â”‚   /api/v1/events     â† Current stable version                              â”‚
â”‚   /api/v2/events     â† New version with breaking changes                   â”‚
â”‚   /api/beta/events   â† Experimental features                               â”‚
â”‚                                                                             â”‚
â”‚   VERSION LIFECYCLE:                                                        â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚  Beta  â”‚â”€â”€â–¶â”‚ Stable â”‚â”€â”€â–¶â”‚ Mature â”‚â”€â”€â–¶â”‚Deprecatedâ”€â”€â–¶â”‚ Sunset â”‚          â”‚
â”‚   â”‚ (v3)   â”‚   â”‚ (v2)   â”‚   â”‚ (v1)   â”‚   â”‚  (v1)  â”‚   â”‚ (v1)   â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚    6 months     Active      12 months    6 months     Removed              â”‚
â”‚                                                                             â”‚
â”‚   DEPRECATION HEADERS:                                                      â”‚
â”‚   Deprecation: true                                                        â”‚
â”‚   Sunset: Sat, 31 Dec 2026 23:59:59 GMT                                    â”‚
â”‚   Link: </api/v2/events>; rel="successor-version"                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.3 Rate Limiting Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MULTI-TIER RATE LIMITING                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   TIER 1: GLOBAL (CDN/WAF Level)                                           â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                           â”‚
â”‚   â€¢ 10,000 requests/minute per IP                                          â”‚
â”‚   â€¢ DDoS protection                                                        â”‚
â”‚   â€¢ Geographic blocking                                                    â”‚
â”‚                                                                             â”‚
â”‚   TIER 2: API GATEWAY                                                       â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                    â”‚
â”‚   â€¢ 1,000 requests/minute per API key                                      â”‚
â”‚   â€¢ Token bucket algorithm                                                 â”‚
â”‚   â€¢ Burst allowance: 50 requests                                           â”‚
â”‚                                                                             â”‚
â”‚   TIER 3: SERVICE LEVEL                                                     â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Endpoint                    â”‚ Anonymous â”‚ User  â”‚ Premium â”‚ Admin  â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  GET  /events                â”‚ 100/min   â”‚ 500   â”‚ 2000    â”‚ âˆ      â”‚   â”‚
â”‚   â”‚  GET  /events/{id}/seats     â”‚ 60/min    â”‚ 300   â”‚ 1000    â”‚ âˆ      â”‚   â”‚
â”‚   â”‚  POST /bookings              â”‚ N/A       â”‚ 10    â”‚ 50      â”‚ âˆ      â”‚   â”‚
â”‚   â”‚  POST /auth/login            â”‚ 5/min     â”‚ 5     â”‚ 5       â”‚ 10     â”‚   â”‚
â”‚   â”‚  POST /auth/register         â”‚ 3/min     â”‚ N/A   â”‚ N/A     â”‚ N/A    â”‚   â”‚
â”‚   â”‚  GET  /search                â”‚ 30/min    â”‚ 100   â”‚ 500     â”‚ âˆ      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   RATE LIMIT HEADERS:                                                       â”‚
â”‚   X-RateLimit-Limit: 100                                                   â”‚
â”‚   X-RateLimit-Remaining: 95                                                â”‚
â”‚   X-RateLimit-Reset: 1703462400                                            â”‚
â”‚   Retry-After: 60 (when 429)                                               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 Rate Limiter Implementation

```javascript
// middleware/rateLimiter.js
const Redis = require('ioredis');

class SlidingWindowRateLimiter {
  constructor(redis) {
    this.redis = redis;
  }

  async isAllowed(key, limit, windowSec) {
    const now = Date.now();
    const windowStart = now - (windowSec * 1000);
    const redisKey = `ratelimit:${key}`;

    // Lua script for atomic sliding window
    const script = `
      local key = KEYS[1]
      local now = tonumber(ARGV[1])
      local window = tonumber(ARGV[2])
      local limit = tonumber(ARGV[3])
      local windowStart = now - window

      -- Remove old entries
      redis.call('ZREMRANGEBYSCORE', key, 0, windowStart)

      -- Count current entries
      local count = redis.call('ZCARD', key)

      if count < limit then
        -- Add new request
        redis.call('ZADD', key, now, now .. '-' .. math.random())
        redis.call('EXPIRE', key, math.ceil(window / 1000))
        return {1, limit - count - 1, math.ceil(window / 1000)}
      else
        -- Get oldest entry for retry-after
        local oldest = redis.call('ZRANGE', key, 0, 0, 'WITHSCORES')
        local retryAfter = math.ceil((oldest[2] + window - now) / 1000)
        return {0, 0, retryAfter}
      end
    `;

    const [allowed, remaining, resetIn] = await this.redis.eval(
      script, 1, redisKey, now, windowSec * 1000, limit
    );

    return {
      allowed: allowed === 1,
      remaining,
      resetIn,
      limit
    };
  }
}

// Express middleware
const rateLimitMiddleware = (options) => {
  const limiter = new SlidingWindowRateLimiter(redis);
  
  return async (req, res, next) => {
    const key = options.keyGenerator(req);
    const limit = options.limitFn ? options.limitFn(req) : options.limit;
    
    const result = await limiter.isAllowed(key, limit, options.windowSec);
    
    // Set headers
    res.set('X-RateLimit-Limit', result.limit);
    res.set('X-RateLimit-Remaining', result.remaining);
    res.set('X-RateLimit-Reset', Math.floor(Date.now() / 1000) + result.resetIn);
    
    if (!result.allowed) {
      res.set('Retry-After', result.resetIn);
      return res.status(429).json({
        error: 'Too Many Requests',
        message: `Rate limit exceeded. Retry after ${result.resetIn} seconds`,
        retryAfter: result.resetIn
      });
    }
    
    next();
  };
};

// Usage with tiered limits
app.use('/api/bookings', rateLimitMiddleware({
  windowSec: 60,
  keyGenerator: (req) => `booking:${req.user?.id || req.ip}`,
  limitFn: (req) => {
    if (req.user?.role === 'admin') return Infinity;
    if (req.user?.isPremium) return 50;
    if (req.user) return 10;
    return 0; // Anonymous cannot book
  }
}));
```

---

## 9. Microservices Architecture

### 9.1 Service Decomposition

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MICROSERVICES BREAKDOWN                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        API GATEWAY                                  â”‚   â”‚
â”‚   â”‚   â€¢ Request routing          â€¢ Authentication                       â”‚   â”‚
â”‚   â”‚   â€¢ Rate limiting            â€¢ Request/Response transformation      â”‚   â”‚
â”‚   â”‚   â€¢ API versioning           â€¢ Circuit breaker                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                 â”‚                                   â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚   â”‚  â”‚ AUTH SERVICE â”‚  â”‚ USER SERVICE â”‚  â”‚EVENT SERVICE â”‚              â”‚   â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Login      â”‚  â”‚ â€¢ Profile    â”‚  â”‚ â€¢ CRUD       â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Register   â”‚  â”‚ â€¢ Preferencesâ”‚  â”‚ â€¢ Search     â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ JWT tokens â”‚  â”‚ â€¢ History    â”‚  â”‚ â€¢ Categories â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ OAuth      â”‚  â”‚ â€¢ Wallet     â”‚  â”‚ â€¢ Featured   â”‚              â”‚   â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ DB: Redis    â”‚  â”‚ DB: Postgres â”‚  â”‚ DB: Postgres â”‚              â”‚   â”‚
â”‚   â”‚  â”‚     +Postgresâ”‚  â”‚              â”‚  â”‚    +Elastic  â”‚              â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚   â”‚  â”‚BOOKING SVC   â”‚  â”‚PAYMENT SVC   â”‚  â”‚NOTIFICATION  â”‚              â”‚   â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚   SERVICE    â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Seat lock  â”‚  â”‚ â€¢ Razorpay   â”‚  â”‚              â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Reservationâ”‚  â”‚ â€¢ PayTM      â”‚  â”‚ â€¢ Email      â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Confirmationâ”‚ â”‚ â€¢ UPI        â”‚  â”‚ â€¢ SMS        â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Cancellationâ”‚ â”‚ â€¢ Refunds    â”‚  â”‚ â€¢ Push       â”‚              â”‚   â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ â€¢ WhatsApp   â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ DB: Postgres â”‚  â”‚ DB: Postgres â”‚  â”‚              â”‚              â”‚   â”‚
â”‚   â”‚  â”‚    +Redis    â”‚  â”‚   (PCI env)  â”‚  â”‚ Queue: Kafka â”‚              â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚   â”‚  â”‚ SEARCH SVC   â”‚  â”‚ANALYTICS SVC â”‚  â”‚ ADMIN SVC    â”‚              â”‚   â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Full-text  â”‚  â”‚ â€¢ Realtime   â”‚  â”‚ â€¢ Dashboard  â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Filters    â”‚  â”‚ â€¢ Reports    â”‚  â”‚ â€¢ User mgmt  â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ â€¢ Suggestionsâ”‚  â”‚ â€¢ Metrics    â”‚  â”‚ â€¢ Event mgmt â”‚              â”‚   â”‚
â”‚   â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚              â”‚   â”‚
â”‚   â”‚  â”‚ DB: Elastic  â”‚  â”‚ DB:ClickHouseâ”‚  â”‚ DB: Postgres â”‚              â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 Service Communication Patterns

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  SERVICE COMMUNICATION MATRIX                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   SYNCHRONOUS (REST/gRPC):                                                  â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                 â”‚
â”‚   Use when: Response needed immediately                                    â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  From â†’ To           â”‚ Protocol â”‚ Timeout â”‚ Use Case                 â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚  Gateway â†’ Auth      â”‚ gRPC     â”‚ 100ms   â”‚ Token validation         â”‚  â”‚
â”‚   â”‚  Booking â†’ Event     â”‚ gRPC     â”‚ 200ms   â”‚ Get seat availability    â”‚  â”‚
â”‚   â”‚  Booking â†’ Payment   â”‚ REST     â”‚ 30s     â”‚ Payment processing       â”‚  â”‚
â”‚   â”‚  Admin â†’ All         â”‚ REST     â”‚ 5s      â”‚ Management operations    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚   ASYNCHRONOUS (Message Queue):                                             â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                            â”‚
â”‚   Use when: Fire-and-forget, eventual consistency OK                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Publisher      â”‚ Event               â”‚ Subscribers                  â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚  Booking        â”‚ booking.created     â”‚ Notification, Analytics      â”‚  â”‚
â”‚   â”‚  Booking        â”‚ booking.confirmed   â”‚ Notification, Invoice        â”‚  â”‚
â”‚   â”‚  Payment        â”‚ payment.completed   â”‚ Booking, Notification        â”‚  â”‚
â”‚   â”‚  Payment        â”‚ payment.failed      â”‚ Booking, Notification        â”‚  â”‚
â”‚   â”‚  User           â”‚ user.registered     â”‚ Notification, Analytics      â”‚  â”‚
â”‚   â”‚  Event          â”‚ event.published     â”‚ Search, Notification         â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.3 gRPC Service Definition

```protobuf
// proto/booking.proto
syntax = "proto3";

package eventmax.booking;

option go_package = "github.com/eventmax/proto/booking";

service BookingService {
  // Reserve seats (with distributed lock)
  rpc ReserveSeats(ReserveRequest) returns (ReserveResponse);
  
  // Confirm booking after payment
  rpc ConfirmBooking(ConfirmRequest) returns (BookingResponse);
  
  // Cancel booking
  rpc CancelBooking(CancelRequest) returns (CancelResponse);
  
  // Get booking details
  rpc GetBooking(GetBookingRequest) returns (BookingResponse);
  
  // Stream seat availability updates
  rpc WatchSeatAvailability(WatchRequest) returns (stream SeatUpdate);
}

message ReserveRequest {
  string event_id = 1;
  string user_id = 2;
  repeated string seat_ids = 3;
  int32 reservation_ttl_seconds = 4; // Default 600 (10 min)
}

message ReserveResponse {
  string reservation_id = 1;
  repeated SeatInfo seats = 2;
  google.protobuf.Timestamp expires_at = 3;
  Money total_amount = 4;
  ReservationStatus status = 5;
}

message SeatInfo {
  string seat_id = 1;
  string label = 2;      // "A-12"
  string section = 3;    // "VIP", "Premium", "Standard"
  string row = 4;
  int32 number = 5;
  Money price = 6;
}

message Money {
  string currency = 1;   // "INR"
  int64 amount_paise = 2; // Amount in smallest unit
}

enum ReservationStatus {
  RESERVATION_STATUS_UNSPECIFIED = 0;
  RESERVATION_PENDING = 1;
  RESERVATION_CONFIRMED = 2;
  RESERVATION_EXPIRED = 3;
  RESERVATION_CANCELLED = 4;
}
```

---

## 10. Message Queue & Event-Driven Architecture

### 10.1 Apache Kafka Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        KAFKA CLUSTER TOPOLOGY                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   3-BROKER CLUSTER                                                          â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                         â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚   â”‚   â”‚  Broker 1   â”‚    â”‚  Broker 2   â”‚    â”‚  Broker 3   â”‚            â”‚   â”‚
â”‚   â”‚   â”‚  (Leader)   â”‚    â”‚  (Follower) â”‚    â”‚  (Follower) â”‚            â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   TOPICS & PARTITIONS:                                                      â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                     â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Topic                  â”‚ Partitions â”‚ Replication â”‚ Retention     â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  booking-events         â”‚ 12         â”‚ 3           â”‚ 7 days        â”‚   â”‚
â”‚   â”‚  payment-events         â”‚ 6          â”‚ 3           â”‚ 30 days       â”‚   â”‚
â”‚   â”‚  notification-requests  â”‚ 6          â”‚ 2           â”‚ 3 days        â”‚   â”‚
â”‚   â”‚  user-activity          â”‚ 12         â”‚ 2           â”‚ 7 days        â”‚   â”‚
â”‚   â”‚  seat-updates           â”‚ 24         â”‚ 2           â”‚ 1 day         â”‚   â”‚
â”‚   â”‚  analytics-events       â”‚ 12         â”‚ 2           â”‚ 90 days       â”‚   â”‚
â”‚   â”‚  dead-letter-queue      â”‚ 3          â”‚ 3           â”‚ 30 days       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   PARTITION KEY STRATEGY:                                                   â”‚
â”‚   â€¢ booking-events: event_id (co-locate all bookings for same event)      â”‚
â”‚   â€¢ payment-events: booking_id (maintain order per booking)               â”‚
â”‚   â€¢ notification-requests: user_id (prevent duplicate sends)              â”‚
â”‚   â€¢ seat-updates: event_id (real-time updates per event)                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 Event Schema (CloudEvents)

```javascript
// Event schema following CloudEvents specification
const bookingCreatedEvent = {
  // CloudEvents required attributes
  specversion: "1.0",
  type: "com.eventmax.booking.created",
  source: "/services/booking",
  id: "A234-1234-1234",
  time: "2025-12-24T17:31:00Z",
  datacontenttype: "application/json",
  
  // EventMax extensions
  eventmaxversion: "1.0",
  correlationid: "req-abc-123",
  
  // Event data
  data: {
    bookingId: "BK2024122400001",
    eventId: "EVT-001",
    userId: "USR-12345",
    seats: [
      { seatId: "S-001", label: "A-12", price: 150000 },
      { seatId: "S-002", label: "A-13", price: 150000 }
    ],
    totalAmount: 300000,
    currency: "INR",
    status: "pending",
    createdAt: "2025-12-24T17:31:00Z",
    expiresAt: "2025-12-24T17:41:00Z"
  }
};

// Kafka producer with exactly-once semantics
const { Kafka } = require('kafkajs');

const kafka = new Kafka({
  clientId: 'booking-service',
  brokers: ['kafka-1:9092', 'kafka-2:9092', 'kafka-3:9092'],
  ssl: true,
  sasl: {
    mechanism: 'scram-sha-512',
    username: process.env.KAFKA_USERNAME,
    password: process.env.KAFKA_PASSWORD
  }
});

const producer = kafka.producer({
  idempotent: true,           // Exactly-once delivery
  maxInFlightRequests: 5,
  transactionalId: 'booking-producer'
});

async function publishBookingEvent(booking) {
  const transaction = await producer.transaction();
  
  try {
    await transaction.send({
      topic: 'booking-events',
      messages: [{
        key: booking.eventId,  // Partition key
        value: JSON.stringify({
          specversion: "1.0",
          type: "com.eventmax.booking.created",
          source: "/services/booking",
          id: `evt-${booking.id}`,
          time: new Date().toISOString(),
          data: booking
        }),
        headers: {
          'correlation-id': booking.correlationId,
          'content-type': 'application/cloudevents+json'
        }
      }]
    });
    
    await transaction.commit();
  } catch (error) {
    await transaction.abort();
    throw error;
  }
}
```

### 10.3 Consumer Group Configuration

```javascript
// Kafka consumer with error handling and DLQ
const consumer = kafka.consumer({
  groupId: 'notification-service',
  sessionTimeout: 30000,
  heartbeatInterval: 3000,
  maxBytesPerPartition: 1048576,  // 1MB
  retry: {
    initialRetryTime: 100,
    retries: 8
  }
});

async function startConsumer() {
  await consumer.connect();
  
  await consumer.subscribe({
    topics: ['booking-events', 'payment-events'],
    fromBeginning: false
  });

  await consumer.run({
    eachBatchAutoResolve: false,
    eachBatch: async ({ batch, resolveOffset, heartbeat, commitOffsetsIfNecessary }) => {
      for (const message of batch.messages) {
        try {
          const event = JSON.parse(message.value.toString());
          
          await processEvent(event);
          
          resolveOffset(message.offset);
          await heartbeat();
          
        } catch (error) {
          console.error('Processing failed:', error);
          
          // Send to Dead Letter Queue after max retries
          await sendToDLQ(message, error);
          resolveOffset(message.offset);
        }
      }
      
      await commitOffsetsIfNecessary();
    }
  });
}

async function sendToDLQ(originalMessage, error) {
  await producer.send({
    topic: 'dead-letter-queue',
    messages: [{
      key: originalMessage.key,
      value: JSON.stringify({
        originalTopic: originalMessage.topic,
        originalPartition: originalMessage.partition,
        originalOffset: originalMessage.offset,
        originalMessage: originalMessage.value.toString(),
        error: error.message,
        failedAt: new Date().toISOString(),
        retryCount: parseInt(originalMessage.headers?.['retry-count'] || '0') + 1
      })
    }]
  });
}
```

---

## 11. Security Architecture

### 11.1 Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DEFENSE IN DEPTH SECURITY                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   LAYER 1: NETWORK SECURITY                                                 â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â€¢ CloudFlare WAF (OWASP Top 10 protection)                        â”‚   â”‚
â”‚   â”‚  â€¢ DDoS mitigation (Layer 3/4/7)                                   â”‚   â”‚
â”‚   â”‚  â€¢ Geo-blocking (block high-risk countries)                        â”‚   â”‚
â”‚   â”‚  â€¢ Bot protection (CAPTCHA for suspicious traffic)                 â”‚   â”‚
â”‚   â”‚  â€¢ TLS 1.3 only (HSTS enabled)                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   LAYER 2: API GATEWAY SECURITY                                             â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â€¢ JWT validation (RS256 signatures)                               â”‚   â”‚
â”‚   â”‚  â€¢ API key authentication                                          â”‚   â”‚
â”‚   â”‚  â€¢ Rate limiting per user/IP                                       â”‚   â”‚
â”‚   â”‚  â€¢ Request size limits (1MB max)                                   â”‚   â”‚
â”‚   â”‚  â€¢ Schema validation                                               â”‚   â”‚
â”‚   â”‚  â€¢ CORS policy enforcement                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   LAYER 3: APPLICATION SECURITY                                             â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â€¢ Input validation & sanitization                                 â”‚   â”‚
â”‚   â”‚  â€¢ SQL injection prevention (parameterized queries)                â”‚   â”‚
â”‚   â”‚  â€¢ XSS prevention (CSP headers, output encoding)                   â”‚   â”‚
â”‚   â”‚  â€¢ CSRF protection (double submit cookies)                         â”‚   â”‚
â”‚   â”‚  â€¢ Session management (Redis with encryption)                      â”‚   â”‚
â”‚   â”‚  â€¢ Password hashing (bcrypt, cost factor 12)                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   LAYER 4: DATA SECURITY                                                    â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  â€¢ Encryption at rest (AES-256)                                    â”‚   â”‚
â”‚   â”‚  â€¢ Encryption in transit (TLS 1.3)                                 â”‚   â”‚
â”‚   â”‚  â€¢ PII data masking in logs                                        â”‚   â”‚
â”‚   â”‚  â€¢ Database row-level security                                     â”‚   â”‚
â”‚   â”‚  â€¢ Secrets management (HashiCorp Vault)                            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.2 JWT Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         JWT AUTHENTICATION FLOW                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. LOGIN                                                                  â”‚
â”‚   â”â”â”â”â”â”â”â”                                                                 â”‚
â”‚   Client â”€â”€POST /auth/loginâ”€â”€â–¶ Auth Service                                â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚                               Validate credentials                         â”‚
â”‚                               Generate tokens                              â”‚
â”‚                                      â”‚                                      â”‚
â”‚   Client â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚   {                                                                        â”‚
â”‚     accessToken: "eyJ...",      // 15 min expiry                          â”‚
â”‚     refreshToken: "eyJ...",     // 7 days expiry                          â”‚
â”‚     expiresIn: 900                                                        â”‚
â”‚   }                                                                        â”‚
â”‚                                                                             â”‚
â”‚   2. API REQUEST                                                            â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                           â”‚
â”‚   Client â”€â”€GET /api/bookingsâ”€â”€â–¶ API Gateway                                â”‚
â”‚   Header: Authorization: Bearer eyJ...                                     â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚                               Validate JWT signature                       â”‚
â”‚                               Check expiration                             â”‚
â”‚                               Extract user claims                          â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚                               Forward to service                           â”‚
â”‚                                      â”‚                                      â”‚
â”‚   Client â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚                                                                             â”‚
â”‚   3. TOKEN REFRESH                                                          â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                         â”‚
â”‚   Client â”€â”€POST /auth/refreshâ”€â”€â–¶ Auth Service                              â”‚
â”‚   { refreshToken: "eyJ..." }                                               â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚                               Validate refresh token                       â”‚
â”‚                               Check if revoked (Redis)                     â”‚
â”‚                               Issue new access token                       â”‚
â”‚                                      â”‚                                      â”‚
â”‚   Client â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
â”‚   { accessToken: "new_eyJ..." }                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 11.3 JWT Implementation

```javascript
// services/authService.js
const jwt = require('jsonwebtoken');
const crypto = require('crypto');

class AuthService {
  constructor() {
    // RSA key pair for JWT signing
    this.privateKey = process.env.JWT_PRIVATE_KEY;
    this.publicKey = process.env.JWT_PUBLIC_KEY;
    
    this.accessTokenExpiry = '15m';
    this.refreshTokenExpiry = '7d';
  }

  generateTokens(user) {
    const payload = {
      sub: user.id,
      email: user.email,
      role: user.role,
      permissions: this.getPermissions(user.role)
    };

    const accessToken = jwt.sign(payload, this.privateKey, {
      algorithm: 'RS256',
      expiresIn: this.accessTokenExpiry,
      issuer: 'eventmax.in',
      audience: 'eventmax-api'
    });

    const refreshToken = jwt.sign(
      { sub: user.id, type: 'refresh', jti: crypto.randomUUID() },
      this.privateKey,
      {
        algorithm: 'RS256',
        expiresIn: this.refreshTokenExpiry,
        issuer: 'eventmax.in'
      }
    );

    // Store refresh token hash in Redis for revocation
    const tokenHash = crypto.createHash('sha256')
      .update(refreshToken)
      .digest('hex');
    
    redis.setex(`refresh:${user.id}:${tokenHash}`, 7 * 24 * 60 * 60, 'valid');

    return { accessToken, refreshToken };
  }

  async verifyAccessToken(token) {
    try {
      const decoded = jwt.verify(token, this.publicKey, {
        algorithms: ['RS256'],
        issuer: 'eventmax.in',
        audience: 'eventmax-api'
      });
      
      // Check if user is still active
      const user = await this.userService.findById(decoded.sub);
      if (!user || !user.isActive) {
        throw new Error('User account is disabled');
      }
      
      return decoded;
    } catch (error) {
      if (error.name === 'TokenExpiredError') {
        throw new AuthError('Token expired', 'TOKEN_EXPIRED');
      }
      throw new AuthError('Invalid token', 'INVALID_TOKEN');
    }
  }

  async revokeAllTokens(userId) {
    // Delete all refresh tokens for user
    const keys = await redis.keys(`refresh:${userId}:*`);
    if (keys.length > 0) {
      await redis.del(...keys);
    }
    
    // Add user to blacklist until all tokens expire
    await redis.setex(`blacklist:${userId}`, 900, 'revoked');
  }

  getPermissions(role) {
    const permissions = {
      customer: ['read:events', 'create:booking', 'read:own_bookings'],
      organizer: ['read:events', 'create:events', 'update:own_events', 'read:event_analytics'],
      staff: ['read:events', 'read:bookings', 'update:bookings', 'checkin:bookings'],
      admin: ['*'] // All permissions
    };
    return permissions[role] || [];
  }
}
```

### 11.4 Security Headers Configuration

```javascript
// middleware/securityHeaders.js
const helmet = require('helmet');

const securityMiddleware = [
  // Helmet with strict CSP
  helmet({
    contentSecurityPolicy: {
      directives: {
        defaultSrc: ["'self'"],
        scriptSrc: ["'self'", "'unsafe-inline'", "https://js.razorpay.com"],
        styleSrc: ["'self'", "'unsafe-inline'", "https://fonts.googleapis.com"],
        imgSrc: ["'self'", "data:", "https:", "blob:"],
        fontSrc: ["'self'", "https://fonts.gstatic.com"],
        connectSrc: ["'self'", "https://api.eventmax.in", "wss://ws.eventmax.in"],
        frameSrc: ["https://api.razorpay.com"],
        objectSrc: ["'none'"],
        baseUri: ["'self'"],
        formAction: ["'self'"],
        frameAncestors: ["'none'"],
        upgradeInsecureRequests: []
      }
    },
    crossOriginEmbedderPolicy: true,
    crossOriginOpenerPolicy: { policy: "same-origin" },
    crossOriginResourcePolicy: { policy: "same-site" },
    hsts: {
      maxAge: 31536000, // 1 year
      includeSubDomains: true,
      preload: true
    },
    noSniff: true,
    referrerPolicy: { policy: "strict-origin-when-cross-origin" },
    xssFilter: true
  }),

  // Additional custom headers
  (req, res, next) => {
    res.setHeader('X-Content-Type-Options', 'nosniff');
    res.setHeader('X-Frame-Options', 'DENY');
    res.setHeader('X-XSS-Protection', '1; mode=block');
    res.setHeader('Permissions-Policy', 
      'geolocation=(), microphone=(), camera=(), payment=(self)');
    next();
  }
];
```

---

## ğŸ“Š Summary - Part 2A Complete

This completes **Part 2A: Low-Level System Design** covering:

âœ… RESTful API design standards & versioning  
âœ… Multi-tier rate limiting with sliding window  
âœ… Microservices decomposition (8 services)  
âœ… Service communication (gRPC + REST + Events)  
âœ… Apache Kafka event-driven architecture  
âœ… CloudEvents schema specification  
âœ… JWT authentication with RS256  
âœ… Defense in depth security layers  
âœ… Security headers (CSP, HSTS, etc.)  

---

## â­ï¸ SAY "CONTINUE" FOR PART 2B

**Part 2B will cover:**
- Monitoring & Observability (Prometheus, Grafana, ELK)
- Distributed Tracing (Jaeger)
- Disaster Recovery & Backup Procedures
- Performance Optimization Techniques
- CI/CD Pipeline with GitOps
- Kubernetes Deployment Manifests
- Cost Optimization Strategies
- Capacity Planning Calculator

---

# PART 2B: MONITORING, DR, CI/CD & OPTIMIZATION

---

## 12. Monitoring & Observability

### 12.1 Observability Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      OBSERVABILITY ARCHITECTURE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   THE THREE PILLARS OF OBSERVABILITY                                       â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                       â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚     METRICS     â”‚  â”‚      LOGS       â”‚  â”‚     TRACES      â”‚            â”‚
â”‚   â”‚   (Prometheus)  â”‚  â”‚  (ELK Stack)    â”‚  â”‚    (Jaeger)     â”‚            â”‚
â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚            â”‚
â”‚   â”‚ â€¢ CPU/Memory    â”‚  â”‚ â€¢ Application   â”‚  â”‚ â€¢ Request flow  â”‚            â”‚
â”‚   â”‚ â€¢ Request rate  â”‚  â”‚ â€¢ Error logs    â”‚  â”‚ â€¢ Latency       â”‚            â”‚
â”‚   â”‚ â€¢ Error rate    â”‚  â”‚ â€¢ Audit logs    â”‚  â”‚ â€¢ Dependencies  â”‚            â”‚
â”‚   â”‚ â€¢ Latency P99   â”‚  â”‚ â€¢ Access logs   â”‚  â”‚ â€¢ Bottlenecks   â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚            â”‚                    â”‚                    â”‚                      â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                 â”‚                                           â”‚
â”‚                                 â–¼                                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚        GRAFANA          â”‚                              â”‚
â”‚                    â”‚   Unified Dashboards    â”‚                              â”‚
â”‚                    â”‚   Alerting & Reporting  â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 12.2 Prometheus Metrics Configuration

```yaml
# prometheus/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'eventmax-prod'
    region: 'ap-south-1'

rule_files:
  - '/etc/prometheus/rules/*.yml'

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']

scrape_configs:
  # Kubernetes service discovery
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
        action: replace
        target_label: __metrics_path__
        regex: (.+)

  # Node metrics
  - job_name: 'node-exporter'
    kubernetes_sd_configs:
      - role: node
    relabel_configs:
      - action: labelmap
        regex: __meta_kubernetes_node_label_(.+)

  # PostgreSQL metrics
  - job_name: 'postgres'
    static_configs:
      - targets: ['postgres-exporter:9187']
    
  # Redis metrics
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']

  # Kafka metrics
  - job_name: 'kafka'
    static_configs:
      - targets: ['kafka-exporter:9308']
```

### 12.3 Custom Application Metrics

```javascript
// middleware/metrics.js
const promClient = require('prom-client');

// Create a Registry
const register = new promClient.Registry();

// Add default metrics (CPU, memory, event loop)
promClient.collectDefaultMetrics({ register });

// Custom metrics
const httpRequestDuration = new promClient.Histogram({
  name: 'http_request_duration_seconds',
  help: 'Duration of HTTP requests in seconds',
  labelNames: ['method', 'route', 'status_code'],
  buckets: [0.01, 0.05, 0.1, 0.25, 0.5, 1, 2.5, 5, 10]
});

const httpRequestsTotal = new promClient.Counter({
  name: 'http_requests_total',
  help: 'Total number of HTTP requests',
  labelNames: ['method', 'route', 'status_code']
});

const activeConnections = new promClient.Gauge({
  name: 'active_connections',
  help: 'Number of active connections',
  labelNames: ['type'] // 'http', 'websocket', 'database'
});

const bookingMetrics = new promClient.Counter({
  name: 'bookings_total',
  help: 'Total number of bookings',
  labelNames: ['status', 'payment_method', 'event_category']
});

const seatReservationDuration = new promClient.Histogram({
  name: 'seat_reservation_duration_seconds',
  help: 'Time taken to reserve seats',
  labelNames: ['event_id', 'seat_count'],
  buckets: [0.1, 0.25, 0.5, 1, 2, 5]
});

const paymentProcessingDuration = new promClient.Histogram({
  name: 'payment_processing_duration_seconds',
  help: 'Time taken to process payment',
  labelNames: ['provider', 'status'],
  buckets: [0.5, 1, 2, 5, 10, 30]
});

// Register all metrics
register.registerMetric(httpRequestDuration);
register.registerMetric(httpRequestsTotal);
register.registerMetric(activeConnections);
register.registerMetric(bookingMetrics);
register.registerMetric(seatReservationDuration);
register.registerMetric(paymentProcessingDuration);

// Middleware to track request metrics
const metricsMiddleware = (req, res, next) => {
  const start = process.hrtime.bigint();
  
  res.on('finish', () => {
    const duration = Number(process.hrtime.bigint() - start) / 1e9;
    const route = req.route?.path || req.path;
    
    httpRequestDuration.observe(
      { method: req.method, route, status_code: res.statusCode },
      duration
    );
    
    httpRequestsTotal.inc({
      method: req.method,
      route,
      status_code: res.statusCode
    });
  });
  
  next();
};

// Expose metrics endpoint
app.get('/metrics', async (req, res) => {
  res.set('Content-Type', register.contentType);
  res.end(await register.metrics());
});

module.exports = { register, metricsMiddleware, bookingMetrics };
```

### 12.4 Alert Rules

```yaml
# prometheus/rules/eventmax-alerts.yml
groups:
  - name: eventmax-critical
    interval: 30s
    rules:
      # High error rate
      - alert: HighErrorRate
        expr: |
          sum(rate(http_requests_total{status_code=~"5.."}[5m])) 
          / sum(rate(http_requests_total[5m])) > 0.05
        for: 2m
        labels:
          severity: critical
          team: backend
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value | humanizePercentage }} (threshold: 5%)"

      # High latency
      - alert: HighLatencyP99
        expr: |
          histogram_quantile(0.99, 
            sum(rate(http_request_duration_seconds_bucket[5m])) by (le, route)
          ) > 2
        for: 5m
        labels:
          severity: warning
          team: backend
        annotations:
          summary: "High P99 latency on {{ $labels.route }}"
          description: "P99 latency is {{ $value | humanizeDuration }}"

      # Database connection pool exhausted
      - alert: DatabaseConnectionPoolExhausted
        expr: pg_stat_activity_count / pg_settings_max_connections > 0.9
        for: 2m
        labels:
          severity: critical
          team: dba
        annotations:
          summary: "Database connection pool nearly exhausted"
          description: "{{ $value | humanizePercentage }} of connections in use"

      # Redis memory high
      - alert: RedisMemoryHigh
        expr: redis_memory_used_bytes / redis_memory_max_bytes > 0.85
        for: 5m
        labels:
          severity: warning
          team: infrastructure
        annotations:
          summary: "Redis memory usage high"
          description: "Redis is using {{ $value | humanizePercentage }} of max memory"

      # Kafka consumer lag
      - alert: KafkaConsumerLag
        expr: kafka_consumer_group_lag > 10000
        for: 5m
        labels:
          severity: warning
          team: backend
        annotations:
          summary: "Kafka consumer lag high"
          description: "Consumer group {{ $labels.consumergroup }} lag: {{ $value }}"

      # Pod restarts
      - alert: PodCrashLooping
        expr: increase(kube_pod_container_status_restarts_total[1h]) > 5
        for: 5m
        labels:
          severity: critical
          team: platform
        annotations:
          summary: "Pod {{ $labels.pod }} is crash looping"
          description: "{{ $value }} restarts in the last hour"

  - name: eventmax-business
    rules:
      # Booking failure rate
      - alert: HighBookingFailureRate
        expr: |
          sum(rate(bookings_total{status="failed"}[10m])) 
          / sum(rate(bookings_total[10m])) > 0.1
        for: 5m
        labels:
          severity: critical
          team: product
        annotations:
          summary: "High booking failure rate"
          description: "{{ $value | humanizePercentage }} of bookings failing"

      # Payment failures
      - alert: PaymentFailureSpike
        expr: |
          sum(rate(payment_processing_duration_seconds_count{status="failed"}[5m])) > 10
        for: 3m
        labels:
          severity: critical
          team: payments
        annotations:
          summary: "Payment failure spike detected"
          description: "{{ $value }} failed payments per second"
```

### 12.5 Distributed Tracing with Jaeger

```javascript
// tracing/jaeger.js
const { NodeTracerProvider } = require('@opentelemetry/sdk-trace-node');
const { JaegerExporter } = require('@opentelemetry/exporter-jaeger');
const { SimpleSpanProcessor, BatchSpanProcessor } = require('@opentelemetry/sdk-trace-base');
const { registerInstrumentations } = require('@opentelemetry/instrumentation');
const { HttpInstrumentation } = require('@opentelemetry/instrumentation-http');
const { ExpressInstrumentation } = require('@opentelemetry/instrumentation-express');
const { PgInstrumentation } = require('@opentelemetry/instrumentation-pg');
const { RedisInstrumentation } = require('@opentelemetry/instrumentation-redis');

const initTracing = (serviceName) => {
  const provider = new NodeTracerProvider({
    resource: {
      attributes: {
        'service.name': serviceName,
        'service.version': process.env.APP_VERSION,
        'deployment.environment': process.env.NODE_ENV
      }
    }
  });

  const exporter = new JaegerExporter({
    endpoint: process.env.JAEGER_ENDPOINT || 'http://jaeger:14268/api/traces'
  });

  // Use BatchSpanProcessor in production
  provider.addSpanProcessor(
    process.env.NODE_ENV === 'production'
      ? new BatchSpanProcessor(exporter, {
          maxQueueSize: 1000,
          scheduledDelayMillis: 5000
        })
      : new SimpleSpanProcessor(exporter)
  );

  provider.register();

  // Auto-instrument popular libraries
  registerInstrumentations({
    instrumentations: [
      new HttpInstrumentation({
        ignoreIncomingPaths: ['/health', '/metrics', '/ready']
      }),
      new ExpressInstrumentation(),
      new PgInstrumentation(),
      new RedisInstrumentation()
    ]
  });

  return provider;
};

// Custom span for business operations
const { trace } = require('@opentelemetry/api');

async function reserveSeats(eventId, seatIds, userId) {
  const tracer = trace.getTracer('booking-service');
  
  return tracer.startActiveSpan('reserveSeats', async (span) => {
    try {
      span.setAttributes({
        'booking.event_id': eventId,
        'booking.seat_count': seatIds.length,
        'booking.user_id': userId
      });

      // Lock seats
      const lockSpan = tracer.startSpan('acquireSeatLocks');
      const locks = await acquireLocks(seatIds);
      lockSpan.end();

      // Verify availability
      const verifySpan = tracer.startSpan('verifySeatAvailability');
      await verifyAvailability(seatIds);
      verifySpan.end();

      // Create reservation
      const reserveSpan = tracer.startSpan('createReservation');
      const reservation = await createReservation(eventId, seatIds, userId);
      reserveSpan.setAttributes({ 'booking.reservation_id': reservation.id });
      reserveSpan.end();

      span.setStatus({ code: SpanStatusCode.OK });
      return reservation;

    } catch (error) {
      span.setStatus({ code: SpanStatusCode.ERROR, message: error.message });
      span.recordException(error);
      throw error;
    } finally {
      span.end();
    }
  });
}
```

### 12.6 ELK Stack Log Configuration

```javascript
// logging/logger.js
const winston = require('winston');
const { ElasticsearchTransport } = require('winston-elasticsearch');

const esTransport = new ElasticsearchTransport({
  level: 'info',
  clientOpts: {
    node: process.env.ELASTICSEARCH_URL || 'http://elasticsearch:9200',
    auth: {
      username: process.env.ES_USERNAME,
      password: process.env.ES_PASSWORD
    }
  },
  indexPrefix: 'eventmax-logs',
  indexSuffixPattern: 'YYYY.MM.DD',
  transformer: (logData) => ({
    '@timestamp': new Date().toISOString(),
    severity: logData.level,
    message: logData.message,
    service: process.env.SERVICE_NAME,
    version: process.env.APP_VERSION,
    environment: process.env.NODE_ENV,
    traceId: logData.meta?.traceId,
    spanId: logData.meta?.spanId,
    userId: logData.meta?.userId,
    ...logData.meta
  })
});

const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  defaultMeta: {
    service: process.env.SERVICE_NAME,
    version: process.env.APP_VERSION
  },
  transports: [
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    }),
    esTransport
  ]
});

// PII masking
const maskPII = (obj) => {
  const masked = { ...obj };
  const sensitiveFields = ['password', 'cardNumber', 'cvv', 'ssn', 'token'];
  
  for (const key of Object.keys(masked)) {
    if (sensitiveFields.some(f => key.toLowerCase().includes(f))) {
      masked[key] = '***REDACTED***';
    } else if (key === 'email' && masked[key]) {
      const [local, domain] = masked[key].split('@');
      masked[key] = `${local[0]}***@${domain}`;
    } else if (key === 'phone' && masked[key]) {
      masked[key] = masked[key].replace(/\d(?=\d{4})/g, '*');
    }
  }
  
  return masked;
};

module.exports = { logger, maskPII };
```

---

## 13. Disaster Recovery & Backup

### 13.1 Backup Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKUP ARCHITECTURE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   BACKUP TIERS                                                              â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”                                                             â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Tier     â”‚ Frequency  â”‚ Retention â”‚ RPO     â”‚ Storage              â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Tier 1   â”‚ Continuous â”‚ 24 hours  â”‚ 0 sec   â”‚ Sync Replica         â”‚   â”‚
â”‚   â”‚  Tier 2   â”‚ Hourly     â”‚ 7 days    â”‚ 1 hour  â”‚ S3 (Same Region)     â”‚   â”‚
â”‚   â”‚  Tier 3   â”‚ Daily      â”‚ 30 days   â”‚ 24 hoursâ”‚ S3 (Cross Region)    â”‚   â”‚
â”‚   â”‚  Tier 4   â”‚ Weekly     â”‚ 1 year    â”‚ 7 days  â”‚ Glacier              â”‚   â”‚
â”‚   â”‚  Tier 5   â”‚ Monthly    â”‚ 7 years   â”‚ 30 days â”‚ Glacier Deep Archive â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   BACKUP FLOW                                                               â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”                                                              â”‚
â”‚                                                                             â”‚
â”‚   PostgreSQL                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚ Primary  â”‚â”€â”€â”€â–¶â”‚ WAL      â”‚â”€â”€â”€â–¶â”‚ pgBackRestâ”€â”€â–¶â”‚ S3       â”‚            â”‚
â”‚   â”‚ Database â”‚    â”‚ Archivingâ”‚    â”‚          â”‚    â”‚ Bucket   â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                             â”‚
â”‚   Redis                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚   â”‚ Redis    â”‚â”€â”€â”€â–¶â”‚ RDB      â”‚â”€â”€â”€â–¶â”‚ S3       â”‚                             â”‚
â”‚   â”‚ Cluster  â”‚    â”‚ Snapshot â”‚    â”‚ Bucket   â”‚                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                             â”‚
â”‚   Elasticsearch                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚   â”‚ ES       â”‚â”€â”€â”€â–¶â”‚ Snapshot â”‚â”€â”€â”€â–¶â”‚ S3       â”‚                             â”‚
â”‚   â”‚ Cluster  â”‚    â”‚ API      â”‚    â”‚ Bucket   â”‚                             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.2 Disaster Recovery Runbook

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DISASTER RECOVERY PROCEDURES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   SCENARIO 1: SINGLE NODE FAILURE                                          â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                         â”‚
â”‚   RTO: < 1 minute | RPO: 0                                                 â”‚
â”‚                                                                             â”‚
â”‚   1. Kubernetes automatically reschedules pod                              â”‚
â”‚   2. Load balancer removes unhealthy node                                  â”‚
â”‚   3. New pod pulls latest image and starts                                 â”‚
â”‚   4. Service mesh routes traffic to healthy pods                           â”‚
â”‚                                                                             â”‚
â”‚   SCENARIO 2: DATABASE PRIMARY FAILURE                                     â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                      â”‚
â”‚   RTO: < 30 seconds | RPO: 0 (sync replica)                                â”‚
â”‚                                                                             â”‚
â”‚   1. Patroni detects primary failure                                       â”‚
â”‚   2. Sync replica promoted to primary                                      â”‚
â”‚   3. DNS/VIP updated to point to new primary                               â”‚
â”‚   4. Applications reconnect via PgBouncer                                  â”‚
â”‚   5. Async replica promoted to sync                                        â”‚
â”‚   6. Alert sent to DBA team                                                â”‚
â”‚                                                                             â”‚
â”‚   SCENARIO 3: AVAILABILITY ZONE FAILURE                                    â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                     â”‚
â”‚   RTO: < 5 minutes | RPO: < 1 minute                                       â”‚
â”‚                                                                             â”‚
â”‚   1. Route 53 health check detects AZ failure                              â”‚
â”‚   2. Traffic routed to healthy AZ                                          â”‚
â”‚   3. Kubernetes scales up pods in healthy AZ                               â”‚
â”‚   4. Database failover to replica in healthy AZ                            â”‚
â”‚   5. Redis cluster rebalances                                              â”‚
â”‚                                                                             â”‚
â”‚   SCENARIO 4: FULL REGION FAILURE                                          â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                         â”‚
â”‚   RTO: < 15 minutes | RPO: < 5 minutes                                     â”‚
â”‚                                                                             â”‚
â”‚   1. Global load balancer detects region failure                           â”‚
â”‚   2. DNS failover to DR region (ap-south-2)                                â”‚
â”‚   3. DR Kubernetes cluster activated                                       â”‚
â”‚   4. Database restored from latest cross-region backup                     â”‚
â”‚   5. Redis warmed up from persistent storage                               â”‚
â”‚   6. Traffic gradually shifted to DR region                                â”‚
â”‚   7. Incident commander notified                                           â”‚
â”‚                                                                             â”‚
â”‚   SCENARIO 5: DATA CORRUPTION / RANSOMWARE                                 â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                    â”‚
â”‚   RTO: < 4 hours | RPO: Based on backup tier                               â”‚
â”‚                                                                             â”‚
â”‚   1. Isolate affected systems immediately                                  â”‚
â”‚   2. Assess extent of corruption                                           â”‚
â”‚   3. Identify clean backup point (PITR)                                    â”‚
â”‚   4. Restore database to isolated environment                              â”‚
â”‚   5. Verify data integrity                                                 â”‚
â”‚   6. Swap restored database into production                                â”‚
â”‚   7. Forensic analysis of attack vector                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.3 Backup Scripts

```bash
#!/bin/bash
# scripts/backup-postgres.sh

set -euo pipefail

# Configuration
BACKUP_DIR="/backups/postgres"
S3_BUCKET="s3://eventmax-backups-ap-south-1/postgres"
RETENTION_DAYS=7
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_NAME="eventmax_${DATE}"

# Create backup using pgBackRest
pgbackrest --stanza=eventmax \
    --type=full \
    --compress-type=zst \
    --compress-level=6 \
    backup

# Verify backup
pgbackrest --stanza=eventmax info

# Upload to S3
aws s3 sync "${BACKUP_DIR}/" "${S3_BUCKET}/" \
    --storage-class STANDARD_IA \
    --exclude "*.tmp"

# Cross-region replication (for DR)
aws s3 sync "${S3_BUCKET}/" "s3://eventmax-backups-ap-south-2/postgres/" \
    --source-region ap-south-1 \
    --region ap-south-2

# Cleanup old local backups
find "${BACKUP_DIR}" -type f -mtime +${RETENTION_DAYS} -delete

# Send metrics to Prometheus
echo "backup_last_success_timestamp $(date +%s)" | \
    curl --data-binary @- http://pushgateway:9091/metrics/job/postgres_backup

echo "Backup completed: ${BACKUP_NAME}"
```

---

## 14. CI/CD Pipeline

### 14.1 GitOps Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GITOPS CI/CD PIPELINE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                            â”‚
â”‚   â”‚ Developer  â”‚                                                            â”‚
â”‚   â”‚ Push Code  â”‚                                                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                            â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                        GITHUB ACTIONS                              â”‚    â”‚
â”‚   â”‚                                                                    â”‚    â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚   â”‚  â”‚  Lint    â”‚â”€â–¶â”‚  Test    â”‚â”€â–¶â”‚  Build   â”‚â”€â–¶â”‚  Scan    â”‚          â”‚    â”‚
â”‚   â”‚  â”‚  Check   â”‚  â”‚  Suite   â”‚  â”‚  Docker  â”‚  â”‚  Trivy   â”‚          â”‚    â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚   â”‚                                                   â”‚               â”‚    â”‚
â”‚   â”‚                                                   â–¼               â”‚    â”‚
â”‚   â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚   â”‚                                            â”‚  Push    â”‚          â”‚    â”‚
â”‚   â”‚                                            â”‚  to ECR  â”‚          â”‚    â”‚
â”‚   â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚         â”‚                                                                   â”‚
â”‚         â–¼                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                        ARGOCD (GitOps)                             â”‚    â”‚
â”‚   â”‚                                                                    â”‚    â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚
â”‚   â”‚  â”‚ Sync Config  â”‚â”€â”€â”€â–¶â”‚ Apply K8s   â”‚â”€â”€â”€â–¶â”‚ Health       â”‚         â”‚    â”‚
â”‚   â”‚  â”‚ from Git     â”‚    â”‚ Manifests   â”‚    â”‚ Check        â”‚         â”‚    â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚   â”‚                                                                    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚   ENVIRONMENTS                                                              â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”                                                             â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚   Dev    â”‚â”€â”€â”€â–¶â”‚  Staging â”‚â”€â”€â”€â–¶â”‚  Canary  â”‚â”€â”€â”€â–¶â”‚   Prod   â”‚            â”‚
â”‚   â”‚  (auto)  â”‚    â”‚  (auto)  â”‚    â”‚  (10%)   â”‚    â”‚  (100%)  â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚     On PR          On Merge       Manual Gate      Auto after              â”‚
â”‚                                                    24h stable              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 14.2 GitHub Actions Workflow

```yaml
# .github/workflows/ci-cd.yml
name: EventMax CI/CD

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  ECR_REGISTRY: 123456789.dkr.ecr.ap-south-1.amazonaws.com
  IMAGE_NAME: eventmax

jobs:
  test:
    runs-on: ubuntu-latest
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test
          POSTGRES_DB: eventmax_test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run linting
        run: npm run lint

      - name: Run unit tests
        run: npm run test:unit -- --coverage
        env:
          DATABASE_URL: postgres://postgres:test@localhost:5432/eventmax_test
          REDIS_URL: redis://localhost:6379

      - name: Run integration tests
        run: npm run test:integration

      - name: Upload coverage
        uses: codecov/codecov-action@v3

  security-scan:
    runs-on: ubuntu-latest
    needs: test
    steps:
      - uses: actions/checkout@v4

      - name: Run Snyk security scan
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}

      - name: Run SAST with Semgrep
        uses: returntocorp/semgrep-action@v1
        with:
          config: p/owasp-top-ten

  build:
    runs-on: ubuntu-latest
    needs: [test, security-scan]
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v4

      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ap-south-1

      - name: Login to Amazon ECR
        uses: aws-actions/amazon-ecr-login@v2

      - name: Build and push Docker image
        uses: docker/build-push-action@v5
        with:
          context: .
          push: true
          tags: |
            ${{ env.ECR_REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
            ${{ env.ECR_REGISTRY }}/${{ env.IMAGE_NAME }}:latest
          cache-from: type=gha
          cache-to: type=gha,mode=max

      - name: Scan image with Trivy
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: ${{ env.ECR_REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
          severity: 'CRITICAL,HIGH'
          exit-code: '1'

  deploy-staging:
    runs-on: ubuntu-latest
    needs: build
    environment: staging
    
    steps:
      - name: Update Kubernetes manifests
        run: |
          git clone https://github.com/eventmax/k8s-config.git
          cd k8s-config/staging
          kustomize edit set image eventmax=${{ env.ECR_REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
          git commit -am "Deploy ${{ github.sha }} to staging"
          git push

  deploy-production:
    runs-on: ubuntu-latest
    needs: deploy-staging
    environment: production
    
    steps:
      - name: Update Kubernetes manifests
        run: |
          git clone https://github.com/eventmax/k8s-config.git
          cd k8s-config/production
          kustomize edit set image eventmax=${{ env.ECR_REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
          git commit -am "Deploy ${{ github.sha }} to production"
          git push

      - name: Notify Slack
        uses: slackapi/slack-github-action@v1
        with:
          payload: |
            {
              "text": "ğŸš€ EventMax deployed to production: ${{ github.sha }}"
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
```

### 14.3 Kubernetes Deployment Manifest

```yaml
# k8s/booking-service/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: booking-service
  namespace: eventmax
  labels:
    app: booking-service
    version: v1
spec:
  replicas: 10
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 0
  selector:
    matchLabels:
      app: booking-service
  template:
    metadata:
      labels:
        app: booking-service
        version: v1
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "3000"
        prometheus.io/path: "/metrics"
    spec:
      serviceAccountName: booking-service
      
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 100
              podAffinityTerm:
                labelSelector:
                  matchLabels:
                    app: booking-service
                topologyKey: topology.kubernetes.io/zone

      containers:
        - name: booking-service
          image: 123456789.dkr.ecr.ap-south-1.amazonaws.com/eventmax:latest
          imagePullPolicy: Always
          
          ports:
            - containerPort: 3000
              name: http
            - containerPort: 9090
              name: grpc

          env:
            - name: NODE_ENV
              value: "production"
            - name: PORT
              value: "3000"
            - name: DATABASE_URL
              valueFrom:
                secretKeyRef:
                  name: booking-service-secrets
                  key: database-url
            - name: REDIS_URL
              valueFrom:
                secretKeyRef:
                  name: booking-service-secrets
                  key: redis-url
            - name: JWT_SECRET
              valueFrom:
                secretKeyRef:
                  name: booking-service-secrets
                  key: jwt-secret

          resources:
            requests:
              cpu: "500m"
              memory: "512Mi"
            limits:
              cpu: "2000m"
              memory: "2Gi"

          livenessProbe:
            httpGet:
              path: /health/live
              port: 3000
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5
            failureThreshold: 3

          readinessProbe:
            httpGet:
              path: /health/ready
              port: 3000
            initialDelaySeconds: 5
            periodSeconds: 5
            timeoutSeconds: 3
            failureThreshold: 3

          lifecycle:
            preStop:
              exec:
                command: ["/bin/sh", "-c", "sleep 15"]

      terminationGracePeriodSeconds: 60

---
apiVersion: v1
kind: Service
metadata:
  name: booking-service
  namespace: eventmax
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: 3000
      name: http
    - port: 9090
      targetPort: 9090
      name: grpc
  selector:
    app: booking-service

---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: booking-service-hpa
  namespace: eventmax
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: booking-service
  minReplicas: 10
  maxReplicas: 100
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 60
    - type: Resource
      resource:
        name: memory
        target:
          type: Utilization
          averageUtilization: 70
```

---

## 15. Cost Optimization

### 15.1 Cost Breakdown & Optimization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MONTHLY COST BREAKDOWN (INR)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   COMPUTE (40% of total)                                                    â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Resource              â”‚ Count  â”‚ Cost/Unit â”‚ Monthly     â”‚ Opt.   â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  EKS Node (m5.xlarge)  â”‚ 20     â”‚ â‚¹12,000   â”‚ â‚¹2,40,000   â”‚ Spot   â”‚   â”‚
â”‚   â”‚  EKS Node (Spot)       â”‚ 30     â”‚ â‚¹4,000    â”‚ â‚¹1,20,000   â”‚ -      â”‚   â”‚
â”‚   â”‚  RDS (r5.2xlarge)      â”‚ 3      â”‚ â‚¹35,000   â”‚ â‚¹1,05,000   â”‚ RI     â”‚   â”‚
â”‚   â”‚  ElastiCache (r5.xl)   â”‚ 6      â”‚ â‚¹18,000   â”‚ â‚¹1,08,000   â”‚ RI     â”‚   â”‚
â”‚   â”‚  MSK (kafka.m5.large)  â”‚ 3      â”‚ â‚¹15,000   â”‚ â‚¹45,000     â”‚ -      â”‚   â”‚
â”‚   â”‚                        â”‚        â”‚ SUBTOTAL  â”‚ â‚¹6,18,000   â”‚        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   STORAGE (15% of total)                                                    â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  S3 Standard           â”‚ 500 GB â”‚ â‚¹2/GB     â”‚ â‚¹1,000      â”‚ IA     â”‚   â”‚
â”‚   â”‚  S3 IA                 â”‚ 2 TB   â”‚ â‚¹1/GB     â”‚ â‚¹2,000      â”‚ -      â”‚   â”‚
â”‚   â”‚  S3 Glacier            â”‚ 10 TB  â”‚ â‚¹0.3/GB   â”‚ â‚¹3,000      â”‚ -      â”‚   â”‚
â”‚   â”‚  EBS (gp3)             â”‚ 2 TB   â”‚ â‚¹8/GB     â”‚ â‚¹16,000     â”‚ -      â”‚   â”‚
â”‚   â”‚  RDS Storage           â”‚ 1 TB   â”‚ â‚¹10/GB    â”‚ â‚¹10,000     â”‚ -      â”‚   â”‚
â”‚   â”‚                        â”‚        â”‚ SUBTOTAL  â”‚ â‚¹32,000     â”‚        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   NETWORK (20% of total)                                                    â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  CloudFront            â”‚ 10 TB  â”‚ â‚¹7/GB     â”‚ â‚¹70,000     â”‚ Commit â”‚   â”‚
â”‚   â”‚  Data Transfer Out     â”‚ 5 TB   â”‚ â‚¹8/GB     â”‚ â‚¹40,000     â”‚ -      â”‚   â”‚
â”‚   â”‚  ALB                   â”‚ 3      â”‚ â‚¹3,000    â”‚ â‚¹9,000      â”‚ -      â”‚   â”‚
â”‚   â”‚  NAT Gateway           â”‚ 3      â”‚ â‚¹4,000    â”‚ â‚¹12,000     â”‚ -      â”‚   â”‚
â”‚   â”‚                        â”‚        â”‚ SUBTOTAL  â”‚ â‚¹1,31,000   â”‚        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   OTHER SERVICES (25% of total)                                             â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  CloudWatch Logs       â”‚ 500 GB â”‚ â‚¹50/GB    â”‚ â‚¹25,000     â”‚ Tier   â”‚   â”‚
â”‚   â”‚  Secrets Manager       â”‚ 50     â”‚ â‚¹40/secretâ”‚ â‚¹2,000      â”‚ -      â”‚   â”‚
â”‚   â”‚  Route 53              â”‚ 5M     â”‚ â‚¹0.4/M    â”‚ â‚¹2,000      â”‚ -      â”‚   â”‚
â”‚   â”‚  ECR                   â”‚ 100 GB â”‚ â‚¹8/GB     â”‚ â‚¹800        â”‚ -      â”‚   â”‚
â”‚   â”‚  Elasticsearch         â”‚ 3 node â”‚ â‚¹25,000   â”‚ â‚¹75,000     â”‚ -      â”‚   â”‚
â”‚   â”‚                        â”‚        â”‚ SUBTOTAL  â”‚ â‚¹1,04,800   â”‚        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   TOTAL MONTHLY:                                          â‚¹9,85,800        â”‚
â”‚   WITH OPTIMIZATIONS (RI + Spot + Commit):                â‚¹6,50,000        â”‚
â”‚   SAVINGS:                                                â‚¹3,35,800 (34%)  â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 15.2 Optimization Strategies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      COST OPTIMIZATION STRATEGIES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   1. COMPUTE OPTIMIZATION                                                   â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                   â”‚
â”‚                                                                             â”‚
â”‚   â€¢ Use Spot Instances for stateless workloads (60% savings)               â”‚
â”‚   â€¢ Reserved Instances for databases (40% savings)                         â”‚
â”‚   â€¢ Graviton (ARM) instances where supported (20% savings)                 â”‚
â”‚   â€¢ Right-size instances based on actual usage                             â”‚
â”‚   â€¢ Implement aggressive auto-scaling                                      â”‚
â”‚                                                                             â”‚
â”‚   2. STORAGE OPTIMIZATION                                                   â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                    â”‚
â”‚                                                                             â”‚
â”‚   â€¢ S3 Intelligent Tiering for unpredictable access                        â”‚
â”‚   â€¢ Lifecycle policies: Standard â†’ IA â†’ Glacier                            â”‚
â”‚   â€¢ gp3 instead of gp2 (20% cheaper, better performance)                   â”‚
â”‚   â€¢ Compress logs before storing                                           â”‚
â”‚   â€¢ Delete unused snapshots automatically                                  â”‚
â”‚                                                                             â”‚
â”‚   3. DATA TRANSFER OPTIMIZATION                                             â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                            â”‚
â”‚                                                                             â”‚
â”‚   â€¢ CloudFront for all static assets                                       â”‚
â”‚   â€¢ Keep traffic within same AZ where possible                             â”‚
â”‚   â€¢ VPC Endpoints for S3/DynamoDB (no NAT charges)                         â”‚
â”‚   â€¢ Compress API responses (gzip/brotli)                                   â”‚
â”‚                                                                             â”‚
â”‚   4. DATABASE OPTIMIZATION                                                  â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                  â”‚
â”‚                                                                             â”‚
â”‚   â€¢ Read replicas for read-heavy workloads                                 â”‚
â”‚   â€¢ Connection pooling (PgBouncer) - fewer connections                     â”‚
â”‚   â€¢ Archive old data to S3 + Athena                                        â”‚
â”‚   â€¢ Provisioned IOPS only when necessary                                   â”‚
â”‚                                                                             â”‚
â”‚   5. OBSERVABILITY OPTIMIZATION                                             â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                             â”‚
â”‚                                                                             â”‚
â”‚   â€¢ Log sampling (10% in production)                                       â”‚
â”‚   â€¢ Metrics aggregation before sending                                     â”‚
â”‚   â€¢ Short retention for debug logs (7 days)                                â”‚
â”‚   â€¢ Use self-hosted alternatives where viable                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 16. Capacity Planning Calculator

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CAPACITY PLANNING FORMULAS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   COMPUTE CAPACITY                                                          â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                         â”‚
â”‚                                                                             â”‚
â”‚   Pods Required = (Peak RPS Ã— Avg Response Time) / (1000 Ã— Target CPU%)    â”‚
â”‚                                                                             â”‚
â”‚   Example:                                                                  â”‚
â”‚   Peak RPS = 50,000                                                        â”‚
â”‚   Avg Response Time = 100ms                                                â”‚
â”‚   Target CPU = 60%                                                         â”‚
â”‚                                                                             â”‚
â”‚   Pods = (50,000 Ã— 0.1) / (1 Ã— 0.6) = 8,333 pods                          â”‚
â”‚   With 4 containers/pod = 2,084 pods                                       â”‚
â”‚   With headroom (1.5x) = 3,126 pods                                        â”‚
â”‚                                                                             â”‚
â”‚   DATABASE CAPACITY                                                         â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                        â”‚
â”‚                                                                             â”‚
â”‚   Connections = (Pods Ã— Connections/Pod) / Pool Efficiency                 â”‚
â”‚                                                                             â”‚
â”‚   Example:                                                                  â”‚
â”‚   Pods = 100                                                               â”‚
â”‚   Connections per pod = 10                                                 â”‚
â”‚   PgBouncer efficiency = 10x                                               â”‚
â”‚                                                                             â”‚
â”‚   Backend Connections = (100 Ã— 10) / 10 = 100 connections                  â”‚
â”‚   RDS max_connections = 100 + 20 (buffer) = 120                            â”‚
â”‚                                                                             â”‚
â”‚   REDIS CAPACITY                                                            â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                          â”‚
â”‚                                                                             â”‚
â”‚   Memory = (Active Users Ã— Session Size) + (Events Ã— Cache Size)           â”‚
â”‚                                                                             â”‚
â”‚   Example:                                                                  â”‚
â”‚   Active Users = 100,000                                                   â”‚
â”‚   Session Size = 2 KB                                                      â”‚
â”‚   Events = 10,000                                                          â”‚
â”‚   Event Cache = 50 KB                                                      â”‚
â”‚                                                                             â”‚
â”‚   Memory = (100,000 Ã— 2 KB) + (10,000 Ã— 50 KB)                            â”‚
â”‚         = 200 MB + 500 MB = 700 MB                                         â”‚
â”‚   With overhead (2x) = 1.4 GB per shard                                    â”‚
â”‚                                                                             â”‚
â”‚   KAFKA CAPACITY                                                            â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                         â”‚
â”‚                                                                             â”‚
â”‚   Partitions = max(Consumer Parallelism, Peak Throughput / Partition Limit)â”‚
â”‚                                                                             â”‚
â”‚   Example:                                                                  â”‚
â”‚   Consumer Instances = 20                                                  â”‚
â”‚   Peak Messages/sec = 10,000                                               â”‚
â”‚   Max per partition = 1,000 msg/sec                                        â”‚
â”‚                                                                             â”‚
â”‚   Partitions = max(20, 10,000/1,000) = 20 partitions                       â”‚
â”‚                                                                             â”‚
â”‚   STORAGE GROWTH                                                            â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                          â”‚
â”‚                                                                             â”‚
â”‚   Monthly Storage = (Bookings Ã— Booking Size) + (Logs Ã— Log Size)          â”‚
â”‚                                                                             â”‚
â”‚   Example:                                                                  â”‚
â”‚   Bookings/month = 500,000                                                 â”‚
â”‚   Booking size = 5 KB                                                      â”‚
â”‚   Logs/month = 10 billion                                                  â”‚
â”‚   Log size = 500 bytes (compressed)                                        â”‚
â”‚                                                                             â”‚
â”‚   Storage = (500,000 Ã— 5 KB) + (10B Ã— 500 B)                              â”‚
â”‚           = 2.5 GB + 5 TB = ~5 TB/month                                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 17. ğŸ†“ FREE & OPEN-SOURCE ALTERNATIVES (For Students/Projects)

> **This section is for developers who want to learn and build without spending money!**

### 17.1 Free Hosting Stack

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    100% FREE DEPLOYMENT STACK                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   FRONTEND (React/Vite)                                                     â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Service          â”‚ Free Tier                â”‚ Best For            â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Vercel           â”‚ Unlimited sites          â”‚ React/Next.js       â”‚   â”‚
â”‚   â”‚  Netlify          â”‚ 100GB bandwidth/month    â”‚ Static + Functions  â”‚   â”‚
â”‚   â”‚  Cloudflare Pages â”‚ Unlimited bandwidth      â”‚ Fastest CDN         â”‚   â”‚
â”‚   â”‚  GitHub Pages     â”‚ Unlimited (public repos) â”‚ Simple static       â”‚   â”‚
â”‚   â”‚  Render           â”‚ 100GB bandwidth/month    â”‚ Full-stack apps     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   BACKEND (Node.js/Express)                                                 â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Service          â”‚ Free Tier                â”‚ Limitations         â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Railway          â”‚ $5 free credits/month    â”‚ Sleeps after idle   â”‚   â”‚
â”‚   â”‚  Render           â”‚ 750 hours/month          â”‚ Sleeps after 15min  â”‚   â”‚
â”‚   â”‚  Fly.io           â”‚ 3 shared VMs free        â”‚ 256MB RAM each      â”‚   â”‚
â”‚   â”‚  Cyclic.sh        â”‚ Unlimited requests       â”‚ 1GB storage         â”‚   â”‚
â”‚   â”‚  Deta.space       â”‚ Unlimited                â”‚ Serverless only     â”‚   â”‚
â”‚   â”‚  Glitch           â”‚ Unlimited                â”‚ Sleeps, 512MB RAM   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   DATABASE (PostgreSQL)                                                     â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Service          â”‚ Free Tier                â”‚ Storage             â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Supabase         â”‚ 500MB + 2 projects       â”‚ Full PostgreSQL     â”‚   â”‚
â”‚   â”‚  Neon             â”‚ 512MB + branching        â”‚ Serverless Postgres â”‚   â”‚
â”‚   â”‚  ElephantSQL      â”‚ 20MB (Tiny Turtle)       â”‚ Shared instance     â”‚   â”‚
â”‚   â”‚  Railway          â”‚ Included in $5 credits   â”‚ Full PostgreSQL     â”‚   â”‚
â”‚   â”‚  Render           â”‚ 90 days free             â”‚ 1GB storage         â”‚   â”‚
â”‚   â”‚  CockroachDB      â”‚ 10GB free forever        â”‚ Distributed SQL     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   REDIS/CACHING                                                             â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Service          â”‚ Free Tier                â”‚ Features            â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  Upstash          â”‚ 10K commands/day         â”‚ Serverless Redis    â”‚   â”‚
â”‚   â”‚  Redis Cloud      â”‚ 30MB free                â”‚ Managed Redis       â”‚   â”‚
â”‚   â”‚  Railway          â”‚ Included in credits      â”‚ Full Redis          â”‚   â”‚
â”‚   â”‚  Memcached Cloud  â”‚ 25MB free                â”‚ Simple caching      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 17.2 Recommended FREE Stack for EventMax

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   RECOMMENDED FREE STACK                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ¯ BEST COMBO FOR YOUR PROJECT:                                          â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Frontend:    Vercel (FREE)                                        â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Automatic deploys from GitHub                    â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Free SSL, CDN, unlimited bandwidth               â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Backend:     Railway (FREE $5/month credits)                      â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Easy deploy from GitHub                          â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Includes PostgreSQL + Redis                      â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Database:    Supabase (FREE - 500MB)                              â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Full PostgreSQL with dashboard                   â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Built-in auth, realtime, storage                 â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   OR                                                                â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Database:    Neon (FREE - 512MB)                                  â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Serverless PostgreSQL                            â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Branching for dev/prod                           â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Cache:       Upstash Redis (FREE - 10K/day)                       â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Serverless, no server to manage                  â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   File Storage: Cloudinary (FREE - 25GB)                            â”‚   â”‚
â”‚   â”‚                â””â”€â”€ Image optimization included                      â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Email:       Resend (FREE - 3000/month)                           â”‚   â”‚
â”‚   â”‚                â””â”€â”€ OR EmailJS (200/month free)                      â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Domain:      Freenom (.tk, .ml, .ga - FREE)                       â”‚   â”‚
â”‚   â”‚                â””â”€â”€ OR use *.vercel.app subdomain                    â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   ğŸ’° TOTAL COST: â‚¹0 (COMPLETELY FREE!)                                     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 17.3 Local Development Setup (FREE)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LOCAL DEVELOPMENT (Your Current Setup)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   YOUR EVENTMAX PROJECT IS ALREADY SET UP FOR FREE LOCAL DEV!              â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   docker-compose.yml                                                â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ PostgreSQL (port 5434)     âœ… FREE                           â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Redis (port 6379)          âœ… FREE                           â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Everything runs locally    âœ… FREE                           â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   Backend: npm run dev           âœ… FREE (port 4000)               â”‚   â”‚
â”‚   â”‚   Frontend: npm run dev          âœ… FREE (port 3000)               â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   TOOLS YOU'RE USING (ALL FREE):                                           â”‚
â”‚   â€¢ Docker Desktop - Free for personal use                                 â”‚
â”‚   â€¢ Node.js - Open source, free                                            â”‚
â”‚   â€¢ PostgreSQL - Open source, free                                         â”‚
â”‚   â€¢ Redis - Open source, free                                              â”‚
â”‚   â€¢ VS Code - Free                                                         â”‚
â”‚   â€¢ Git/GitHub - Free for public/private repos                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 17.4 Free Monitoring & Observability

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FREE MONITORING OPTIONS                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   LOGGING                                                                   â”‚
â”‚   â”â”â”â”â”â”â”â”                                                                 â”‚
â”‚   â€¢ console.log() - Already built-in! ğŸ˜„                                   â”‚
â”‚   â€¢ Logtail - 1GB/month free                                               â”‚
â”‚   â€¢ Papertrail - 16MB/day free                                             â”‚
â”‚   â€¢ Logz.io - 1GB/day free                                                 â”‚
â”‚                                                                             â”‚
â”‚   MONITORING & ALERTS                                                       â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”                                                      â”‚
â”‚   â€¢ UptimeRobot - 50 monitors free (checks if site is up)                  â”‚
â”‚   â€¢ Grafana Cloud - 10K metrics free                                       â”‚
â”‚   â€¢ New Relic - 100GB/month free                                           â”‚
â”‚   â€¢ Sentry - 5K errors/month free (error tracking)                         â”‚
â”‚                                                                             â”‚
â”‚   ANALYTICS                                                                 â”‚
â”‚   â”â”â”â”â”â”â”â”â”â”                                                               â”‚
â”‚   â€¢ Vercel Analytics - Free with Vercel hosting                            â”‚
â”‚   â€¢ Plausible - Self-hosted (free)                                         â”‚
â”‚   â€¢ Umami - Self-hosted (free, open source)                                â”‚
â”‚   â€¢ Google Analytics - Free (but privacy concerns)                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 17.5 Free CI/CD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FREE CI/CD OPTIONS                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Service          â”‚ Free Minutes/Month  â”‚ Best For                 â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  GitHub Actions   â”‚ 2,000 mins (public) â”‚ Everything!              â”‚   â”‚
â”‚   â”‚  GitLab CI        â”‚ 400 mins            â”‚ Full DevOps              â”‚   â”‚
â”‚   â”‚  Vercel           â”‚ Automatic (âˆ)       â”‚ Frontend builds          â”‚   â”‚
â”‚   â”‚  Netlify          â”‚ 300 mins            â”‚ Frontend builds          â”‚   â”‚
â”‚   â”‚  Railway          â”‚ Automatic           â”‚ Auto-deploy on push      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   RECOMMENDED: Just push to GitHub â†’ Vercel/Railway auto-deploy!           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 17.6 Quick Deploy Guide (FREE)

```bash
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# DEPLOY EVENTMAX FOR FREE IN 10 MINUTES
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# STEP 1: Create accounts (all free, no credit card needed)
# - https://vercel.com (Frontend)
# - https://railway.app (Backend + DB) OR
# - https://supabase.com (Database only)

# STEP 2: Push your code to GitHub
git add .
git commit -m "Ready for deployment"
git push origin main

# STEP 3: Deploy Frontend to Vercel
# - Go to vercel.com
# - Click "Import Project"
# - Select your GitHub repo
# - Set root directory: frontend
# - Click Deploy!
# - Your site is live at: https://eventmax.vercel.app

# STEP 4: Deploy Backend to Railway
# - Go to railway.app
# - Click "New Project" â†’ "Deploy from GitHub"
# - Select your repo, set root: backend
# - Add PostgreSQL from Railway dashboard (free)
# - Add environment variables
# - Your API is live at: https://eventmax-backend.railway.app

# STEP 5: Connect Frontend to Backend
# - In Vercel, add environment variable:
#   VITE_API_URL=https://eventmax-backend.railway.app

# DONE! ğŸ‰ Your app is live for FREE!
```

### 17.7 Free vs Paid Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FREE vs PAID COMPARISON                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Feature              â”‚ Free Tier        â”‚ Paid (Enterprise)              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚   Users Supported      â”‚ ~100-500         â”‚ 100,000+                       â”‚
â”‚   Response Time        â”‚ 200-500ms        â”‚ <100ms                         â”‚
â”‚   Uptime SLA           â”‚ ~95%             â”‚ 99.99%                         â”‚
â”‚   Database Size        â”‚ 500MB-1GB        â”‚ Unlimited                      â”‚
â”‚   Bandwidth            â”‚ Limited          â”‚ Unlimited                      â”‚
â”‚   Auto-scaling         â”‚ âŒ               â”‚ âœ…                             â”‚
â”‚   Multi-region         â”‚ âŒ               â”‚ âœ…                             â”‚
â”‚   Support              â”‚ Community        â”‚ 24/7 Enterprise                â”‚
â”‚   Cold Starts          â”‚ Yes (5-10s)      â”‚ No                             â”‚
â”‚   Custom Domain        â”‚ Limited          â”‚ Unlimited                      â”‚
â”‚   SSL                  â”‚ âœ…               â”‚ âœ…                             â”‚
â”‚                                                                             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚   ğŸ’¡ FREE TIER IS PERFECT FOR:                                             â”‚
â”‚   â€¢ Learning & Development                                                  â”‚
â”‚   â€¢ Portfolio Projects                                                      â”‚
â”‚   â€¢ Hackathons                                                             â”‚
â”‚   â€¢ MVP/Proof of Concept                                                   â”‚
â”‚   â€¢ Small hobby projects                                                   â”‚
â”‚   â€¢ College/University projects                                            â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š COMPLETE DOCUMENT SUMMARY

### Part 1: High-Level System Design âœ…
1. âœ… Executive Summary & Capacity Planning
2. âœ… System Overview & Goals
3. âœ… Architecture Patterns (CQRS, Event Sourcing, Circuit Breaker)
4. âœ… Scalability & Load Balancing
5. âœ… Multi-Level Caching Architecture
6. âœ… Database Architecture (PostgreSQL HA, Sharding)
7. âœ… High Availability & Fault Tolerance

### Part 2A: Low-Level System Design âœ…
8. âœ… API Design & Rate Limiting
9. âœ… Microservices Architecture
10. âœ… Message Queue & Event-Driven (Kafka)
11. âœ… Security Architecture (JWT, Defense in Depth)

### Part 2B: Operations & Optimization âœ…
12. âœ… Monitoring & Observability (Prometheus, Grafana, Jaeger, ELK)
13. âœ… Disaster Recovery & Backup
14. âœ… CI/CD Pipeline (GitHub Actions, ArgoCD, Kubernetes)
15. âœ… Cost Optimization Strategies
16. âœ… Capacity Planning Calculator

---

## ğŸ¯ KEY METRICS SUMMARY

| Metric | Target | Architecture Solution |
|--------|--------|----------------------|
| **Concurrent Users** | 100,000+ | Horizontal scaling, Redis sessions |
| **Requests/Second** | 50,000 RPS | Load balancing, CDN, caching |
| **Response Time (P99)** | < 200ms | Multi-level cache, read replicas |
| **Uptime SLA** | 99.99% | Multi-AZ, auto-failover |
| **RPO** | < 1 minute | Sync replication, WAL archiving |
| **RTO** | < 5 minutes | Patroni failover, DR automation |
| **Monthly Cost** | â‚¹6.5 Lakhs | Spot, RI, optimization |

---

**ğŸ† This architecture is designed to scale EventMax to handle millions of users with enterprise-grade reliability, security, and performance.**





